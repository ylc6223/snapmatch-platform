<?xml version="1.0" encoding="UTF-8"?>
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="1364"
  height="960"
  viewBox="0 0 1364 960"
  role="img"
  aria-label="SnapMatch 管理后台单域名部署系统架构图"
>
  <defs>
    <style>
      .title { font: 700 18px -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; fill: #0f172a; }
      .label { font: 600 16px -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; fill: #0f172a; }
      .text { font: 500 14px -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; fill: #0f172a; }
      .sub { font: 400 12px -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; fill: #334155; }
      .muted { font: 400 12px -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; fill: #475569; }
      .box { rx: 10; ry: 10; stroke: #0f172a; stroke-opacity: .18; stroke-width: 1; }
      .box-strong { rx: 10; ry: 10; stroke: #0f172a; stroke-opacity: .28; stroke-width: 1.2; }
      .dash { rx: 12; ry: 12; stroke: #0f172a; stroke-opacity: .28; stroke-width: 1.2; stroke-dasharray: 6 5; }
      .layer-border { rx: 16; ry: 16; stroke: #0f172a; stroke-opacity: .22; stroke-width: 1.2; }
      .arrow { stroke: #0f172a; stroke-opacity: .55; stroke-width: 1.5; fill: none; }
      .arrow-label { font: 500 12px -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; fill: #0f172a; opacity: .75; }
    </style>

    <linearGradient id="g-client" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="#bfe3ff"/>
      <stop offset="1" stop-color="#d8efff"/>
    </linearGradient>
    <linearGradient id="g-edge" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="#bdf7ff"/>
      <stop offset="1" stop-color="#d6fffb"/>
    </linearGradient>
    <linearGradient id="g-app" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="#bff3d1"/>
      <stop offset="1" stop-color="#ddffe9"/>
    </linearGradient>
    <linearGradient id="g-cloud" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="#d9f7c9"/>
      <stop offset="1" stop-color="#f0ffe6"/>
    </linearGradient>
    <linearGradient id="g-ops" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="#e6eaff"/>
      <stop offset="1" stop-color="#f4f6ff"/>
    </linearGradient>

    <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="7" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#0f172a" opacity=".55"/>
    </marker>
  </defs>

  <!-- canvas -->
  <rect x="0" y="0" width="1364" height="960" fill="#ffffff"/>

  <!-- header -->
  <text x="682" y="36" text-anchor="middle" class="title">SnapMatch 管理后台（单域名同源）设计与部署架构</text>
  <text x="682" y="58" text-anchor="middle" class="muted">推荐：网关/反向代理按路径分流（/ → Next Admin，/api → Nest API）+ accessToken/refreshToken（HttpOnly Cookie）</text>

  <!-- common geometry -->
  <!-- left labels: x=20 w=120, right layer: x=150 w=1194 -->

  <!-- Layer 1: Client -->
  <rect x="20" y="80" width="120" height="150" fill="url(#g-client)" class="layer-border"/>
  <text x="80" y="165" text-anchor="middle" class="label">客户端</text>

  <rect x="150" y="80" width="1194" height="150" fill="#f8fbff" class="layer-border"/>
  <rect x="170" y="112" width="540" height="92" fill="#ffffff" class="box"/>
  <text x="190" y="142" class="text">运营/管理员浏览器</text>
  <text x="190" y="164" class="sub">访问：https://admin.example.com</text>
  <text x="190" y="186" class="sub">主要交互：登录、表格/筛选、内容配置</text>

  <rect x="730" y="112" width="594" height="92" fill="#ffffff" class="box"/>
  <text x="750" y="142" class="text">前端鉴权策略（浏览器侧）</text>
  <text x="750" y="164" class="sub">admin_access_token：HttpOnly Cookie（由 BFF 转发为 Authorization: Bearer）</text>
  <text x="750" y="186" class="sub">admin_refresh_token：HttpOnly Cookie（用于 refresh/logout）</text>

  <!-- Layer 2: Edge -->
  <rect x="20" y="240" width="120" height="160" fill="url(#g-edge)" class="layer-border"/>
  <text x="80" y="330" text-anchor="middle" class="label">入口层</text>

  <rect x="150" y="240" width="1194" height="160" fill="#f7fffe" class="layer-border"/>
  <rect x="170" y="270" width="330" height="110" fill="#ffffff" class="box"/>
  <text x="190" y="300" class="text">DNS / HTTPS 证书</text>
  <text x="190" y="322" class="sub">域名解析 + TLS 终止</text>
  <text x="190" y="344" class="sub">建议：HSTS + 强密码套件</text>

  <rect x="520" y="270" width="320" height="110" fill="#ffffff" class="box"/>
  <text x="540" y="300" class="text">CDN / WAF（可选）</text>
  <text x="540" y="322" class="sub">静态资源加速</text>
  <text x="540" y="344" class="sub">基础防护/限流</text>

  <rect x="860" y="262" width="464" height="126" fill="#ffffff" class="dash"/>
  <text x="882" y="290" class="text">网关 / 反向代理（路径分流）</text>
  <rect x="882" y="304" width="420" height="32" fill="#eefcff" class="box"/>
  <text x="898" y="325" class="sub">/  → Next Admin（apps/admin）</text>
  <rect x="882" y="340" width="420" height="32" fill="#eefcff" class="box"/>
  <text x="898" y="361" class="sub">/api → Nest API（apps/backend）</text>

  <!-- arrows Client -> Gateway -->
  <path d="M780,204 L780,258" class="arrow" marker-end="url(#arrowHead)"/>
  <text x="790" y="240" class="arrow-label">HTTPS</text>

  <!-- Layer 3: Application -->
  <rect x="20" y="410" width="120" height="240" fill="url(#g-app)" class="layer-border"/>
  <text x="80" y="535" text-anchor="middle" class="label">应用层</text>

  <rect x="150" y="410" width="1194" height="240" fill="#f7fff9" class="layer-border"/>

  <rect x="170" y="440" width="1154" height="180" fill="#ffffff" class="dash"/>
  <text x="192" y="468" class="text">CloudBase 云托管（CloudRun，容器模式）</text>

  <!-- Admin -->
  <rect x="210" y="488" width="360" height="112" fill="#f3fff8" class="box-strong"/>
  <text x="230" y="518" class="text">Admin Web（Next.js）</text>
  <text x="230" y="540" class="sub">apps/admin · App Router</text>
  <text x="230" y="562" class="sub">请求：同源 /api（BFF）</text>
  <text x="230" y="584" class="sub">登录页 / 业务页面 / RBAC UI 控制</text>

  <!-- Backend -->
  <rect x="610" y="488" width="360" height="112" fill="#f3fff8" class="box-strong"/>
  <text x="630" y="518" class="text">Backend API（NestJS）</text>
  <text x="630" y="540" class="sub">apps/backend · JWT + RBAC</text>
  <text x="630" y="562" class="sub">/auth/login、/auth/me、/auth/refresh、/auth/logout</text>
  <text x="630" y="584" class="sub">统一返回错误码 + 403 权限提示</text>

  <!-- Auth box -->
  <rect x="1010" y="488" width="290" height="112" fill="#f3fff8" class="box"/>
  <text x="1030" y="518" class="text">鉴权与会话</text>
  <text x="1030" y="540" class="sub">accessToken：短有效期 JWT</text>
  <text x="1030" y="562" class="sub">refreshToken：旋转刷新（auth_sessions 落库）</text>
  <text x="1030" y="584" class="sub">401：清 cookie → 重新登录；403：统一提示</text>

  <!-- arrows Admin -> Backend -->
  <path d="M570,544 L610,544" class="arrow" marker-end="url(#arrowHead)"/>
  <text x="580" y="534" class="arrow-label">/api/*</text>

  <!-- Layer 4: CloudBase Resources -->
  <rect x="20" y="660" width="120" height="220" fill="url(#g-cloud)" class="layer-border"/>
  <text x="80" y="780" text-anchor="middle" class="label">云开发资源</text>

  <rect x="150" y="660" width="1194" height="220" fill="#fbfff7" class="layer-border"/>

  <!-- Functions -->
  <rect x="170" y="690" width="360" height="170" fill="#ffffff" class="dash"/>
  <text x="192" y="718" class="text">云函数（Cloud Functions）</text>
  <rect x="192" y="734" width="316" height="34" fill="#f6fff2" class="box"/>
  <text x="208" y="756" class="sub">DDL/建表/迁移脚本（按需）</text>
  <rect x="192" y="772" width="316" height="34" fill="#f6fff2" class="box"/>
  <text x="208" y="794" class="sub">定时任务/运维任务（可选）</text>
  <rect x="192" y="810" width="316" height="34" fill="#f6fff2" class="box"/>
  <text x="208" y="832" class="sub">对接第三方服务（可选）</text>

  <!-- Data -->
  <rect x="550" y="690" width="420" height="170" fill="#ffffff" class="dash"/>
  <text x="572" y="718" class="text">数据与存储</text>
  <rect x="572" y="734" width="376" height="34" fill="#f6fff2" class="box"/>
  <text x="588" y="756" class="sub">MySQL（推荐：业务主数据）</text>
  <rect x="572" y="772" width="376" height="34" fill="#f6fff2" class="box"/>
  <text x="588" y="794" class="sub">Redis（可选：缓存/限流/会话黑名单）</text>
  <rect x="572" y="810" width="376" height="34" fill="#f6fff2" class="box"/>
  <text x="588" y="832" class="sub">云存储（图片/素材直传，Signed URL）</text>

  <!-- Observability -->
  <rect x="990" y="690" width="334" height="170" fill="#ffffff" class="dash"/>
  <text x="1012" y="718" class="text">可观测与安全</text>
  <rect x="1012" y="734" width="290" height="34" fill="#f6fff2" class="box"/>
  <text x="1028" y="756" class="sub">日志/监控/告警（按平台接入）</text>
  <rect x="1012" y="772" width="290" height="34" fill="#f6fff2" class="box"/>
  <text x="1028" y="794" class="sub">审计日志（建议：写接口必记）</text>
  <rect x="1012" y="810" width="290" height="34" fill="#f6fff2" class="box"/>
  <text x="1028" y="832" class="sub">密钥管理（ENV/Secret，禁硬编码）</text>

  <!-- arrows Backend -> Resources -->
  <path d="M790,620 L790,680" class="arrow" marker-end="url(#arrowHead)"/>
  <text x="802" y="660" class="arrow-label">SDK/HTTP</text>

  <!-- Layer 5: DevOps -->
  <rect x="20" y="890" width="120" height="50" fill="url(#g-ops)" class="layer-border"/>
  <text x="80" y="920" text-anchor="middle" class="label">运维发布</text>

  <rect x="150" y="890" width="1194" height="50" fill="#f7f8ff" class="layer-border"/>
  <rect x="170" y="902" width="340" height="26" fill="#ffffff" class="box"/>
  <text x="182" y="920" class="sub">CI/CD：pnpm monorepo 构建 + Docker 镜像</text>
  <rect x="530" y="902" width="360" height="26" fill="#ffffff" class="box"/>
  <text x="542" y="920" class="sub">多环境：dev/test/prod（独立 ENV_ID + 独立配置）</text>
  <rect x="910" y="902" width="414" height="26" fill="#ffffff" class="box"/>
  <text x="922" y="920" class="sub">发布：CloudRun 部署/回滚 + 配置变更审计</text>
</svg>
