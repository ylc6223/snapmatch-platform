# æ¶æ„è®¾è®¡

> **æ‰€å±é˜¶æ®µ**ï¼š[é¡¹ç›®è§„åˆ’ä¸æ¶æ„è®¾è®¡](./README.md)
> **é¢„è®¡æ—¶é•¿**ï¼š2-3 å°æ—¶
> **éš¾åº¦ç­‰çº§**ï¼šâ­â­â­â˜†â˜†

## ğŸ“‹ ç« èŠ‚å¤§çº²

### ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¶æ„è®¾è®¡æ¦‚è¿°

- ä»€ä¹ˆæ˜¯æ¶æ„è®¾è®¡
- ä¸ºä»€ä¹ˆæ¶æ„è®¾è®¡å¾ˆé‡è¦
- æ¶æ„è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™
- æ¶æ„è§†å›¾ä¸ç»´åº¦

### ç¬¬äºŒéƒ¨åˆ†ï¼šSnapMatch é¡¹ç›®æ¶æ„è®¾è®¡å®æˆ˜

- æ•´ä½“æ¶æ„è®¾è®¡
- åç«¯æ¶æ„è®¾è®¡ï¼ˆNestJSï¼‰
- å‰ç«¯æ¶æ„è®¾è®¡ï¼ˆNext.jsï¼‰
- æ•°æ®æ¶æ„è®¾è®¡
- éƒ¨ç½²æ¶æ„è®¾è®¡

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¶æ„æ¨¡å¼ä¸å®è·µ

- åˆ†å±‚æ¶æ„
- æ¨¡å—åŒ–è®¾è®¡
- ä¾èµ–æ³¨å…¥
- ä»“å‚¨æ¨¡å¼
- ç­–ç•¥æ¨¡å¼

### ç¬¬å››éƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸å¸¸è§é™·é˜±

- æ¶æ„è®¾è®¡æœ€ä½³å®è·µ
- å¸¸è§æ¶æ„é™·é˜±
- æ¶æ„æ¼”è¿›ç­–ç•¥
- æ¶æ„è¯„å®¡æ–¹æ³•

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬èŠ‚åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- [ ] ç†è§£æ¶æ„è®¾è®¡çš„é‡è¦æ€§å’Œæ ¸å¿ƒåŸåˆ™
- [ ] æŒæ¡åˆ†å±‚æ¶æ„å’Œæ¨¡å—åŒ–è®¾è®¡æ–¹æ³•
- [ ] èƒ½å¤Ÿè®¾è®¡æ¸…æ™°ã€å¯ç»´æŠ¤çš„ç³»ç»Ÿæ¶æ„
- [ ] å­¦ä¼šä½¿ç”¨å¸¸è§æ¶æ„æ¨¡å¼
- [ ] é¿å…æ¶æ„è®¾è®¡ä¸­çš„å¸¸è§é™·é˜±

## ğŸ’¡ å…³é”®è¦ç‚¹

- **æ¶æ„æ˜¯åŸºç¡€**ï¼šè‰¯å¥½çš„æ¶æ„æ˜¯é¡¹ç›®é•¿æœŸæ¼”è¿›çš„åŸºç¡€
- **åˆ†å±‚è§£è€¦**ï¼šæ¸…æ™°çš„å±‚æ¬¡åˆ’åˆ†é™ä½ç³»ç»Ÿå¤æ‚åº¦
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šé«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—æ˜“äºç»´æŠ¤
- **é¢å‘æ¥å£**ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- **æŒç»­æ¼”è¿›**ï¼šæ¶æ„æ˜¯æ¼”åŒ–çš„ï¼Œä¸æ˜¯ä¸€æˆä¸å˜çš„

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¶æ„è®¾è®¡æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯æ¶æ„è®¾è®¡

**æ¶æ„è®¾è®¡ï¼ˆArchitecture Designï¼‰** æ˜¯åœ¨ç³»ç»Ÿå¼€å‘æ—©æœŸï¼Œé€šè¿‡ç³»ç»Ÿçš„è§„åˆ’å’Œè®¾è®¡ï¼Œæ˜ç¡®ç³»ç»Ÿçš„ï¼š

- **æ•´ä½“ç»“æ„**ï¼ˆç³»ç»Ÿç»„æˆå’Œå…³ç³»ï¼‰
- **æŠ€æœ¯é€‰å‹**ï¼ˆæŠ€æœ¯æ ˆå’Œæ¡†æ¶ï¼‰
- **æ¨¡å—åˆ’åˆ†**ï¼ˆåŠŸèƒ½è¾¹ç•Œå’ŒèŒè´£ï¼‰
- **äº¤äº’æ–¹å¼**ï¼ˆé€šä¿¡åè®®å’Œæ•°æ®æµï¼‰
- **éƒ¨ç½²ç­–ç•¥**ï¼ˆè¿è¡Œç¯å¢ƒå’Œæ‰©å±•æ–¹å¼ï¼‰

#### æ¶æ„è®¾è®¡ vs è¯¦ç»†è®¾è®¡

| ç»´åº¦         | æ¶æ„è®¾è®¡                   | è¯¦ç»†è®¾è®¡                   |
| ------------ | -------------------------- | -------------------------- |
| **å…³æ³¨ç‚¹**   | ç³»ç»Ÿæ•´ä½“ç»“æ„ã€æ¨¡å—å…³ç³»     | å…·ä½“å®ç°ã€ç®—æ³•é€»è¾‘         |
| **æŠ½è±¡å±‚æ¬¡** | é«˜å±‚æŠ½è±¡                   | ä½å±‚è¯¦ç»†                   |
| **æ—¶é—´ç‚¹**   | é¡¹ç›®æ—©æœŸ                   | æ¶æ„è®¾è®¡å                 |
| **è¾“å‡ºç‰©**   | æ¶æ„å›¾ã€æ¨¡å—åˆ’åˆ†ã€æ¥å£å®šä¹‰ | ç±»å›¾ã€æµç¨‹å›¾ã€è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| **å—ä¼—**     | æ¶æ„å¸ˆã€æŠ€æœ¯è´Ÿè´£äºº         | å¼€å‘å·¥ç¨‹å¸ˆ                 |

### 1.2 ä¸ºä»€ä¹ˆæ¶æ„è®¾è®¡å¾ˆé‡è¦

#### çœŸå®æ¡ˆä¾‹ï¼šæ¶æ„æ··ä¹±çš„ä»£ä»·

| é—®é¢˜         | å½±å“                 | ä»£ä»·                 |
| ------------ | -------------------- | -------------------- |
| æ¨¡å—è¾¹ç•Œä¸æ¸… | ä»£ç ä¿®æ”¹ç‰µä¸€å‘åŠ¨å…¨èº« | å¼€å‘æ•ˆç‡é™ä½ 60%     |
| ç¼ºä¹æŠ½è±¡     | éš¾ä»¥æ›¿æ¢åº•å±‚å®ç°     | é‡æ„æˆæœ¬å¢åŠ  3 å€    |
| å¾ªç¯ä¾èµ–     | æµ‹è¯•å›°éš¾ã€éƒ¨ç½²å¤æ‚   | æµ‹è¯•è¦†ç›–ç‡ä½ 30%     |
| æŠ€æœ¯å€ºåŠ¡ç´¯ç§¯ | æ–°åŠŸèƒ½å¼€å‘è¶Šæ¥è¶Šæ…¢   | æ¯ä¸ªåŠŸèƒ½è€—æ—¶å¢åŠ  50% |

#### æ¶æ„è®¾è®¡çš„ä»·å€¼

âœ… **é™ä½å¤æ‚åº¦**ï¼šé€šè¿‡åˆ†å±‚å’Œæ¨¡å—åŒ–ï¼Œåˆ†è§£å¤æ‚é—®é¢˜
âœ… **æé«˜å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„è¾¹ç•Œè®©ä¿®æ”¹æ›´åŠ å®‰å…¨
âœ… **æ”¯æŒå›¢é˜Ÿåä½œ**ï¼šæ¨¡å—åŒ–æ”¯æŒå¤šäººå¹¶è¡Œå¼€å‘
âœ… **ä¾¿äºæ‰©å±•**ï¼šè‰¯å¥½çš„æ¶æ„æ”¯æŒåŠŸèƒ½æ‰©å±•
âœ… **é™ä½é£é™©**ï¼šæ—©æœŸå‘ç°æ¶æ„é—®é¢˜ï¼Œé¿å…åæœŸå¤§æ”¹

### 1.3 æ¶æ„è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™

#### SOLID åŸåˆ™åœ¨æ¶æ„ä¸­çš„åº”ç”¨

**1. Single Responsibilityï¼ˆå•ä¸€èŒè´£ï¼‰**

æ¯ä¸ªæ¨¡å—/ç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸã€‚

```markdown
âœ… å¥½çš„æ¶æ„ï¼š

- UsersControllerï¼šå¤„ç†ç”¨æˆ·ç›¸å…³çš„ HTTP è¯·æ±‚
- UsersServiceï¼šå¤„ç†ç”¨æˆ·ä¸šåŠ¡é€»è¾‘
- UsersRepositoryï¼šå¤„ç†ç”¨æˆ·æ•°æ®è®¿é—®

âŒ å·®çš„æ¶æ„ï¼š

- UserManagerï¼šåŒæ—¶å¤„ç†è¯·æ±‚ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®
```

**2. Open/Closedï¼ˆå¼€é—­åŸåˆ™ï¼‰**

å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚

```typescript
// âœ… å¥½çš„è®¾è®¡ï¼šé€šè¿‡æ¥å£æ‰©å±•
interface IStorageProvider {
  upload(file: File): Promise<string>;
  download(url: string): Promise<Stream>;
}

// æ–°å¢å­˜å‚¨æ–¹å¼æ—¶ï¼Œåªéœ€æ·»åŠ æ–°çš„ Provider
class R2StorageProvider implements IStorageProvider {}
class S3StorageProvider implements IStorageProvider {}

// âŒ å·®çš„è®¾è®¡ï¼šæ¯æ¬¡æ–°å¢éƒ½è¦ä¿®æ”¹ç°æœ‰ä»£ç 
class StorageService {
  upload(file: File, provider: 'r2' | 's3' | 'oss') {
    if (provider === 'r2') {
      /* ... */
    } else if (provider === 's3') {
      /* ... */
    }
    // æ¯æ¬¡æ–°å¢å­˜å‚¨æ–¹å¼éƒ½è¦ä¿®æ”¹è¿™é‡Œ
  }
}
```

**3. Liskov Substitutionï¼ˆé‡Œæ°æ›¿æ¢ï¼‰**

å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»è€Œä¸å½±å“ç¨‹åºæ­£ç¡®æ€§ã€‚

```typescript
// âœ… å¥½çš„è®¾è®¡
abstract class BaseController {
  abstract findAll(): Promise<any[]>;
}

class UsersController extends BaseController {
  async findAll(): Promise<User[]> {
    /* ... */
  }
}

// çˆ¶ç±»èƒ½ç”¨çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šèƒ½ç”¨
const controller: BaseController = new UsersController();
```

**4. Interface Segregationï¼ˆæ¥å£éš”ç¦»ï¼‰**

å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚

```typescript
// âœ… å¥½çš„è®¾è®¡ï¼šæ¥å£ç»†ç²’åº¦
interface IReadable {
  findById(id: string): Promise<any>;
  findAll(): Promise<any[]>;
}

interface IWritable {
  create(data: any): Promise<any>;
  update(id: string, data: any): Promise<any>;
  delete(id: string): Promise<void>;
}

// åªè¯»æ“ä½œåªéœ€ä¾èµ– IReadable
class ReadOnlyService {
  constructor(private readonly repo: IReadable) {}
}

// âŒ å·®çš„è®¾è®¡ï¼šæ¥å£è¿‡äºåºå¤§
interface IRepository {
  findById(id: string): Promise<any>;
  findAll(): Promise<any[]>;
  create(data: any): Promise<any>;
  update(id: string, data: any): Promise<any>;
  delete(id: string): Promise<void>;
  // ... 100 more methods
}
```

**5. Dependency Inversionï¼ˆä¾èµ–å€’ç½®ï¼‰**

ä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°ã€‚

```typescript
// âœ… å¥½çš„è®¾è®¡ï¼šä¾èµ–æ¥å£
class UsersService {
  constructor(private readonly usersRepo: IUsersRepository) {}
}

// âŒ å·®çš„è®¾è®¡ï¼šä¾èµ–å…·ä½“å®ç°
class UsersService {
  constructor(private readonly usersRepo: MysqlUsersRepository) {}
}
```

#### å…¶ä»–æ ¸å¿ƒåŸåˆ™

**1. åˆ†å±‚åŸåˆ™ï¼ˆLayered Architectureï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Presentation Layer    â”‚  â† æ¥å£å±‚ï¼ˆControllerï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Business Logic Layer  â”‚  â† ä¸šåŠ¡å±‚ï¼ˆServiceï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Data Access Layer     â”‚  â† æ•°æ®å±‚ï¼ˆRepositoryï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Database / Storage    â”‚  â† å­˜å‚¨å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. æ¨¡å—åŒ–åŸåˆ™ï¼ˆModularizationï¼‰**

```markdown
- é«˜å†…èšï¼ˆHigh Cohesionï¼‰ï¼šç›¸å…³åŠŸèƒ½èšé›†åœ¨ä¸€èµ·
- ä½è€¦åˆï¼ˆLow Couplingï¼‰ï¼šæ¨¡å—é—´ä¾èµ–å°½å¯èƒ½å°‘
- æ˜ç¡®è¾¹ç•Œï¼ˆClear Boundaryï¼‰ï¼šæ¯ä¸ªæ¨¡å—æœ‰æ¸…æ™°çš„èŒè´£
```

**3. DRY åŸåˆ™ï¼ˆDon't Repeat Yourselfï¼‰**

```markdown
âœ… å¥½çš„åšæ³•ï¼š

- æå–å…¬å…±é€»è¾‘åˆ°å·¥å…·å‡½æ•°
- ä½¿ç”¨åŸºç±»å‡å°‘é‡å¤ä»£ç 
- é€šè¿‡ç»„åˆå¤ç”¨è¡Œä¸º

âŒ å·®çš„åšæ³•ï¼š

- å¤åˆ¶ç²˜è´´ä»£ç 
- ç›¸ä¼¼é€»è¾‘åœ¨å¤šå¤„å®ç°
```

### 1.4 æ¶æ„è§†å›¾ä¸ç»´åº¦

#### 4+1 æ¶æ„è§†å›¾

**Philippe Krutchen çš„ 4+1 è§†å›¾æ¨¡å‹**ï¼š

1. **é€»è¾‘è§†å›¾ï¼ˆLogical Viewï¼‰**
   - åŠŸèƒ½éœ€æ±‚åˆ†è§£
   - å…³é”®ç±»å’Œå¯¹è±¡
   - æ¥å£å’ŒèŒè´£

2. **å®ç°è§†å›¾ï¼ˆImplementation Viewï¼‰**
   - ä»£ç ç»„ç»‡ç»“æ„
   - æ¨¡å—åˆ’åˆ†
   - ä¾èµ–å…³ç³»

3. **è¿›ç¨‹è§†å›¾ï¼ˆProcess Viewï¼‰**
   - è¿è¡Œæ—¶è¡Œä¸º
   - è¿›ç¨‹å’Œçº¿ç¨‹
   - å¹¶å‘å’ŒåŒæ­¥

4. **éƒ¨ç½²è§†å›¾ï¼ˆDeployment Viewï¼‰**
   - ç‰©ç†éƒ¨ç½²
   - ç½‘ç»œæ‹“æ‰‘
   - ç¡¬ä»¶é…ç½®

5. **ç”¨ä¾‹è§†å›¾ï¼ˆUse Case Viewï¼‰**
   - ç”¨æˆ·åœºæ™¯
   - åŠŸèƒ½éœ€æ±‚
   - ç³»ç»Ÿè¾¹ç•Œ

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šSnapMatch é¡¹ç›®æ¶æ„è®¾è®¡å®æˆ˜

### 2.1 æ•´ä½“æ¶æ„è®¾è®¡

#### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        A1[Web å®¢æˆ·ç«¯]
        A2[Admin ç®¡ç†ç«¯]
    end

    subgraph "å‰ç«¯åº”ç”¨å±‚"
        B1[apps/web<br/>Next.js 16]
        B2[apps/admin<br/>Next.js 16]
    end

    subgraph "åç«¯æœåŠ¡å±‚"
        C1[apps/backend<br/>NestJS 11]
        C2[Auth Module]
        C3[Users Module]
        C4[Assets Module]
    end

    subgraph "æ•°æ®å­˜å‚¨å±‚"
        D1[(MySQL 8.0)]
        D2[(Cloudflare R2)]
    end

    subgraph "éƒ¨ç½²å±‚"
        E1[Docker å®¹å™¨]
        E2[åå‘ä»£ç†]
    end

    A1 -->|HTTP| B1
    A2 -->|HTTP| B2
    B1 -->|API| C1
    B2 -->|API| C1

    C1 --> C2
    C1 --> C3
    C1 --> C4

    C2 -->|Query| D1
    C3 -->|Query| D1
    C4 -->|Upload| D2

    C1 -->|Deploy| E1
    B1 -->|Deploy| E1
    B2 -->|Deploy| E1
```

#### æ¶æ„ç‰¹ç‚¹

**1. å‰åç«¯åˆ†ç¦»**

```markdown
**ä¼˜åŠ¿**ï¼š

- å‰åç«¯ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²
- æŠ€æœ¯æ ˆé€‰æ‹©çµæ´»
- èŒè´£æ¸…æ™°

**å®ç°**ï¼š

- å‰ç«¯ï¼šNext.jsï¼ˆWeb + Adminï¼‰
- åç«¯ï¼šNestJS RESTful API
- é€šä¿¡ï¼šHTTP/JSON
```

**2. å¤šåº”ç”¨æ¶æ„**

```markdown
**åº”ç”¨åˆ’åˆ†**ï¼š

- apps/webï¼šé¢å‘å®¢æˆ·çš„ Web åº”ç”¨
- apps/adminï¼šç®¡ç†åå°åº”ç”¨
- apps/backendï¼šåç«¯ API æœåŠ¡

**ä¼˜åŠ¿**ï¼š

- ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- ä»£ç éš”ç¦»
- å›¢é˜Ÿå¹¶è¡Œå¼€å‘
```

**3. æ¨¡å—åŒ–åç«¯**

```markdown
**æ¨¡å—åˆ’åˆ†**ï¼š

- authï¼šè®¤è¯æˆæƒæ¨¡å—
- usersï¼šç”¨æˆ·ç®¡ç†æ¨¡å—
- assetsï¼šèµ„æºç®¡ç†æ¨¡å—
- commonï¼šå…¬å…±æ¨¡å—

**æ¨¡å—ç‰¹æ€§**ï¼š

- ç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- å¯ç‹¬ç«‹æµ‹è¯•
```

### 2.2 åç«¯æ¶æ„è®¾è®¡ï¼ˆNestJSï¼‰

#### ç›®å½•ç»“æ„

```
apps/backend/src/
â”œâ”€â”€ main.ts                      # åº”ç”¨å…¥å£
â”œâ”€â”€ app.module.ts                # æ ¹æ¨¡å—
â”‚
â”œâ”€â”€ auth/                        # è®¤è¯æˆæƒæ¨¡å—
â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”œâ”€â”€ guards/                  # å®ˆå«
â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts
â”‚   â”‚   â”œâ”€â”€ roles.guard.ts
â”‚   â”‚   â””â”€â”€ permissions.guard.ts
â”‚   â”œâ”€â”€ strategies/              # ç­–ç•¥
â”‚   â”‚   â””â”€â”€ jwt.strategy.ts
â”‚   â”œâ”€â”€ decorators/              # è£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ current-user.decorator.ts
â”‚   â”‚   â”œâ”€â”€ roles.decorator.ts
â”‚   â”‚   â””â”€â”€ permissions.decorator.ts
â”‚   â”œâ”€â”€ dto/                     # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ login.dto.ts
â”‚   â”‚   â””â”€â”€ auth-user.dto.ts
â”‚   â””â”€â”€ sessions/                # ä¼šè¯ç®¡ç†
â”‚       â”œâ”€â”€ auth-sessions.service.ts
â”‚       â””â”€â”€ auth-sessions.repository.ts
â”‚
â”œâ”€â”€ users/                       # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”œâ”€â”€ users.admin.controller.ts
â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”œâ”€â”€ users.repository.ts
â”‚   â””â”€â”€ dto/                     # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚       â”œâ”€â”€ create-user.dto.ts
â”‚       â”œâ”€â”€ update-user.dto.ts
â”‚       â””â”€â”€ list-users.query.ts
â”‚
â”œâ”€â”€ assets/                      # èµ„æºç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ assets.module.ts
â”‚   â”œâ”€â”€ assets.controller.ts
â”‚   â””â”€â”€ assets.service.ts
â”‚
â”œâ”€â”€ common/                      # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ storage/                 # å­˜å‚¨æŠ½è±¡
â”‚   â”‚   â”œâ”€â”€ storage.module.ts
â”‚   â”‚   â”œâ”€â”€ storage.service.ts
â”‚   â”‚   â”œâ”€â”€ storage.interface.ts
â”‚   â”‚   â””â”€â”€ providers/
â”‚   â”‚       â””â”€â”€ r2.provider.ts
â”‚   â”œâ”€â”€ filters/                 # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â””â”€â”€ api-exception.filter.ts
â”‚   â”œâ”€â”€ interceptors/            # æ‹¦æˆªå™¨
â”‚   â”‚   â””â”€â”€ response-envelope.interceptor.ts
â”‚   â””â”€â”€ types/                   # å…¬å…±ç±»å‹
â”‚       â””â”€â”€ api-response.ts
â”‚
â”œâ”€â”€ database/                    # æ•°æ®åº“æ¨¡å—
â”‚   â”œâ”€â”€ mysql.module.ts
â”‚   â””â”€â”€ entities/                # å®ä½“å®šä¹‰
â”‚       â”œâ”€â”€ rbac-user.entity.ts
â”‚       â”œâ”€â”€ rbac-role.entity.ts
â”‚       â”œâ”€â”€ rbac-permission.entity.ts
â”‚       â””â”€â”€ auth-session.entity.ts
â”‚
â””â”€â”€ health/                      # å¥åº·æ£€æŸ¥
    â””â”€â”€ health.controller.ts
```

#### åˆ†å±‚æ¶æ„è¯¦è§£

**1. Controller å±‚ï¼ˆè¡¨ç°å±‚ï¼‰**

```typescript
// apps/backend/src/auth/auth.controller.ts
@Controller('auth')
export class AuthController {
  constructor(private readonly authService: AuthService) {}

  @Post('login')
  async login(@Body() loginDto: LoginDto) {
    // åªè´Ÿè´£å¤„ç† HTTP è¯·æ±‚
    // ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
    return this.authService.login(loginDto);
  }
}
```

**èŒè´£**ï¼š

- æ¥æ”¶ HTTP è¯·æ±‚
- å‚æ•°éªŒè¯
- è°ƒç”¨ Service å±‚
- è¿”å› HTTP å“åº”

**2. Service å±‚ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰**

```typescript
// apps/backend/src/auth/auth.service.ts
@Injectable()
export class AuthService {
  constructor(
    private readonly usersService: UsersService,
    private readonly sessionsService: AuthSessionsService,
  ) {}

  async login(loginDto: LoginDto) {
    // 1. éªŒè¯ç”¨æˆ·
    const user = await this.usersService.findByUsername(loginDto.username);

    // 2. éªŒè¯å¯†ç 
    const isValid = await bcrypt.compare(loginDto.password, user.password);
    if (!isValid) {
      throw new UnauthorizedException('Invalid credentials');
    }

    // 3. ç”Ÿæˆ Token
    const tokens = await this.generateTokens(user);

    // 4. åˆ›å»ºä¼šè¯
    await this.sessionsService.create(user.id, tokens.refreshToken);

    return tokens;
  }
}
```

**èŒè´£**ï¼š

- å®ç°ä¸šåŠ¡é€»è¾‘
- äº‹åŠ¡ç®¡ç†
- è°ƒç”¨ Repository å±‚
- æ•°æ®è½¬æ¢

**3. Repository å±‚ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰**

```typescript
// apps/backend/src/users/users.repository.mysql.ts
@Injectable()
export class UsersRepository implements IUsersRepository {
  constructor(@InjectDataSource() private readonly dataSource: DataSource) {}

  async findById(id: string): Promise<User | null> {
    const result = await this.dataSource.query('SELECT * FROM rbac_users WHERE id = ?', [id]);
    return result[0] || null;
  }

  async create(userData: CreateUserData): Promise<User> {
    // çº¯æ•°æ®æ“ä½œï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
    // ...
  }
}
```

**èŒè´£**ï¼š

- æ•°æ®åº“æ“ä½œ
- SQL æ‰§è¡Œ
- ç»“æœæ˜ å°„
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

#### ä¾èµ–æ³¨å…¥æ¶æ„

**NestJS çš„ DI å®¹å™¨**ï¼š

```typescript
// 1. å®šä¹‰æ¥å£ï¼ˆæŠ½è±¡ï¼‰
export interface IUsersRepository {
  findById(id: string): Promise<User | null>;
  create(data: CreateUserData): Promise<User>;
}

// 2. å®ç°æ¥å£ï¼ˆå…·ä½“ï¼‰
@Injectable()
export class UsersRepository implements IUsersRepository {
  // MySQL å®ç°
}

// 3. åœ¨ Module ä¸­æ³¨å†Œ
@Module({
  controllers: [UsersController],
  providers: [
    UsersService,
    {
      provide: 'IUsersRepository',
      useClass: UsersRepository,
    },
  ],
})
export class UsersModule {}

// 4. åœ¨ Service ä¸­æ³¨å…¥ï¼ˆä¾èµ–æŠ½è±¡ï¼‰
export class UsersService {
  constructor(
    @Inject('IUsersRepository')
    private readonly usersRepo: IUsersRepository, // ä¾èµ–æ¥å£
  ) {}
}
```

**ä¼˜åŠ¿**ï¼š

- ä½è€¦åˆï¼šService ä¸ä¾èµ–å…·ä½“å®ç°
- å¯æµ‹è¯•ï¼šæ˜“äºæ³¨å…¥ Mock å¯¹è±¡
- å¯æ›¿æ¢ï¼šåˆ‡æ¢å®ç°åªéœ€ä¿®æ”¹ Module é…ç½®

### 2.3 å‰ç«¯æ¶æ„è®¾è®¡ï¼ˆNext.jsï¼‰

#### åº”ç”¨ç»“æ„

```
apps/admin/
â”œâ”€â”€ app/                          # App Router
â”‚   â”œâ”€â”€ (guest)/                  # è·¯ç”±ç»„ï¼šè®¿å®¢
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ dashboard/                # è·¯ç”±ç»„ï¼šä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ analytics/
â”‚   â”‚   â”œâ”€â”€ portfolio/
â”‚   â”‚   â”œâ”€â”€ crm/
â”‚   â”‚   â”œâ”€â”€ delivery/
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ [...path]/
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ components/                   # ç»„ä»¶åº“
â”‚   â”œâ”€â”€ ui/                       # Radix UI ç»„ä»¶
â”‚   â”œâ”€â”€ forms/                    # è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ layouts/                  # å¸ƒå±€ç»„ä»¶
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ api.ts                    # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ auth.ts                   # è®¤è¯å·¥å…·
â”‚   â””â”€â”€ utils.ts
â”‚
â”œâ”€â”€ hooks/                        # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ use-auth.ts
â”‚   â””â”€â”€ use-api.ts
â”‚
â””â”€â”€ middleware.ts                 # ä¸­é—´ä»¶
```

#### Next.js App Router ç‰¹æ€§

**1. æ–‡ä»¶ç³»ç»Ÿè·¯ç”±**

```typescript
app/
â”œâ”€â”€ (guest)/
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx              # â†’ /login
â”‚   â””â”€â”€ register/
â”‚       â””â”€â”€ page.tsx              # â†’ /register
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ portfolio/
â”‚   â”‚   â””â”€â”€ page.tsx              # â†’ /dashboard/portfolio
â”‚   â””â”€â”€ layout.tsx                # å…±äº«å¸ƒå±€
â””â”€â”€ layout.tsx                    # æ ¹å¸ƒå±€
```

**2. è·¯ç”±ç»„ï¼ˆRoute Groupsï¼‰**

```typescript
// (guest) è·¯ç”±ç»„ - ä¸å½±å“ URL
app/(guest)/
â”œâ”€â”€ login/page.tsx        # URL: /login
â”œâ”€â”€ register/page.tsx     # URL: /register
â””â”€â”€ layout.tsx            # å…±äº«å¸ƒå±€ï¼šæ— éœ€è®¤è¯

// dashboard è·¯ç”±ç»„
app/dashboard/
â”œâ”€â”€ portfolio/page.tsx    # URL: /dashboard/portfolio
â”œâ”€â”€ settings/page.tsx     # URL: /dashboard/settings
â””â”€â”€ layout.tsx            # å…±äº«å¸ƒå±€ï¼šéœ€è¦è®¤è¯
```

**3. Server Actions**

```typescript
// app/actions/auth.ts
'use server';

export async function loginAction(formData: FormData) {
  const username = formData.get('username');
  const password = formData.get('password');

  // ç›´æ¥è°ƒç”¨åç«¯ API
  const response = await fetch('http://localhost:3000/api/auth/login', {
    method: 'POST',
    body: JSON.stringify({ username, password }),
  });

  // æœåŠ¡ç«¯è®¾ç½® Cookie
  // ...
}
```

#### çŠ¶æ€ç®¡ç†æ¶æ„

**ä½¿ç”¨ Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†**ï¼š

```typescript
// hooks/use-auth.ts
interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;

  login: (credentials: LoginDto) => Promise<void>;
  logout: () => void;
  refresh: () => Promise<void>;
}

export const useAuth = create<AuthState>((set, get) => ({
  user: null,
  token: null,
  isAuthenticated: false,

  login: async (credentials) => {
    const response = await api.post('/auth/login', credentials);
    set({
      user: response.user,
      token: response.accessToken,
      isAuthenticated: true,
    });
  },

  logout: () => {
    set({
      user: null,
      token: null,
      isAuthenticated: false,
    });
  },

  refresh: async () => {
    const { refreshToken } = get();
    const response = await api.post('/auth/refresh', { refreshToken });
    set({ token: response.accessToken });
  },
}));
```

### 2.4 æ•°æ®æ¶æ„è®¾è®¡

#### æ•°æ®æµå›¾

```mermaid
sequenceDiagram
    participant C as Client
    participant Ctrl as Controller
    participant Svc as Service
    participant Repo as Repository
    participant DB as Database

    C->>Ctrl: HTTP Request
    Ctrl->>Ctrl: DTO Validation
    Ctrl->>Svc: call service method()
    Svc->>Repo: call repository method()
    Repo->>DB: SQL Query
    DB-->>Repo: Result
    Repo-->>Svc: Domain Entity
    Svc->>Svc: Business Logic
    Svc-->>Ctrl: Response DTO
    Ctrl-->>C: HTTP Response
```

#### æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰è®¾è®¡

**1. è¯·æ±‚ DTO**

```typescript
// apps/backend/src/auth/dto/login.dto.ts
export class LoginDto {
  @IsString()
  @MinLength(3)
  username: string;

  @IsString()
  @MinLength(6)
  password: string;
}
```

**2. å“åº” DTO**

```typescript
// apps/backend/src/auth/dto/auth-login-response.dto.ts
export class AuthLoginResponseDto {
  user: {
    id: string;
    username: string;
    role: string;
  };
  tokens: {
    accessToken: string;
    refreshToken: string;
    expiresIn: number;
  };
}
```

**3. æŸ¥è¯¢ DTO**

```typescript
// apps/backend/src/users/dto/list-users.query.ts
export class ListUsersQuery {
  @IsOptional()
  @Type(() => Number)
  page?: number = 1;

  @IsOptional()
  @Type(() => Number)
  limit?: number = 10;

  @IsOptional()
  @IsString()
  search?: string;

  @IsOptional()
  @IsString()
  role?: string;
}
```

#### æ•°æ®åº“è®¾è®¡åŸåˆ™

**1. å‘½åè§„èŒƒ**

```sql
-- è¡¨åï¼šå°å†™ + ä¸‹åˆ’çº¿
rbac_users
rbac_roles
auth_sessions

-- å­—æ®µåï¼šå°å†™ + ä¸‹åˆ’çº¿
user_id
created_at
is_active

-- ç´¢å¼•åï¼šidx_è¡¨å_å­—æ®µå
idx_rbac_users_username
idx_auth_sessions_user_id
```

**2. å­—æ®µç±»å‹**

```sql
-- ä¸»é”®ï¼šä½¿ç”¨ BIGINT
id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY

-- æ—¶é—´ï¼šç»Ÿä¸€ä½¿ç”¨ DATETIME æˆ– TIMESTAMP
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP

-- çŠ¶æ€ï¼šä½¿ç”¨ TINYINT
is_active TINYINT(1) DEFAULT 1
is_deleted TINYINT(1) DEFAULT 0

-- é‡‘é¢ï¼šä½¿ç”¨ DECIMAL
amount DECIMAL(10, 2) NOT NULL
```

**3. ç´¢å¼•ç­–ç•¥**

```sql
-- 1. ä¸»é”®ç´¢å¼•
PRIMARY KEY (id)

-- 2. å”¯ä¸€ç´¢å¼•
UNIQUE KEY uk_username (username)

-- 3. æ™®é€šç´¢å¼•
KEY idx_email (email)

-- 4. å¤åˆç´¢å¼•
KEY idx_user_created (user_id, created_at)

-- 5. å…¨æ–‡ç´¢å¼•
FULLTEXT KEY ft_content (title, content)
```

### 2.5 éƒ¨ç½²æ¶æ„è®¾è®¡

#### Docker å®¹å™¨åŒ–éƒ¨ç½²

**Dockerfile è®¾è®¡**ï¼š

```dockerfile
# ========== é˜¶æ®µ 1: ä¾èµ–å®‰è£… ==========
FROM node:20-alpine AS deps
WORKDIR /app
RUN corepack enable pnpm
COPY package.json pnpm-lock.yaml ./
RUN pnpm install --frozen-lockfile

# ========== é˜¶æ®µ 2: æ„å»º ==========
FROM node:20-alpine AS build
WORKDIR /app
RUN corepack enable pnpm
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN pnpm build

# ========== é˜¶æ®µ 3: è¿è¡Œæ—¶ ==========
FROM node:20-alpine AS runner
WORKDIR /app

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nestjs
USER nestjs

COPY --from=build --chown=nestjs:nodejs /app/dist ./dist
COPY --from=build --chown=nestjs:nodejs /app/node_modules ./node_modules
COPY --from=build --chown=nestjs:nodejs /app/package.json ./

ENV NODE_ENV=production
ENV PORT=3000

EXPOSE 3000
CMD ["node", "dist/main.js"]
```

**ä¼˜åŠ¿**ï¼š

- ç¯å¢ƒä¸€è‡´æ€§ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸€è‡´
- å¿«é€Ÿéƒ¨ç½²ï¼šé•œåƒæ„å»ºåå¯åœ¨ä»»æ„ç¯å¢ƒè¿è¡Œ
- èµ„æºéš”ç¦»ï¼šå®¹å™¨çº§åˆ«èµ„æºéš”ç¦»
- æ˜“äºæ‰©å±•ï¼šå¿«é€Ÿåˆ›å»ºæ–°å®ä¾‹

#### å¤šé˜¶æ®µéƒ¨ç½²ç­–ç•¥

**å¼€å‘ç¯å¢ƒ**ï¼š

```yaml
# docker-compose.dev.yml
version: '3.8'
services:
  backend:
    build: .
    command: pnpm run start:dev
    volumes:
      - ./apps/backend/src:/app/src
    environment:
      - NODE_ENV=development
    ports:
      - '3000:3000'
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š

```yaml
# docker-compose.prod.yml
version: '3.8'
services:
  backend:
    image: snapmatch-backend:latest
    restart: always
    environment:
      - NODE_ENV=production
      - DATABASE_URL=mysql://...
    ports:
      - '3000:3000'
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}
    volumes:
      - mysql_data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    restart: always
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¶æ„æ¨¡å¼ä¸å®è·µ

### 3.1 åˆ†å±‚æ¶æ„

#### ä¸‰å±‚æ¶æ„æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Presentation Layer              â”‚  â† å¤„ç†ç”¨æˆ·äº¤äº’
â”‚     (Controller/Components)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Business Logic Layer            â”‚  â† å¤„ç†ä¸šåŠ¡é€»è¾‘
â”‚     (Service/Domain)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Data Access Layer               â”‚  â† å¤„ç†æ•°æ®æŒä¹…åŒ–
â”‚     (Repository/DAO)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š

- èŒè´£åˆ†ç¦»ï¼šæ¯å±‚æœ‰æ˜ç¡®çš„èŒè´£
- æ˜“äºæµ‹è¯•ï¼šå¯ä»¥å•ç‹¬æµ‹è¯•æ¯ä¸€å±‚
- å¯æ›¿æ¢ï¼šæ›´æ¢åº•å±‚å®ç°ä¸å½±å“ä¸Šå±‚

**SnapMatch ä¸­çš„åº”ç”¨**ï¼š

```typescript
// Controller å±‚
@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get()
  findAll() {
    return this.usersService.findAll();
  }
}

// Service å±‚
@Injectable()
export class UsersService {
  constructor(private readonly usersRepo: UsersRepository) {}

  async findAll() {
    // ä¸šåŠ¡é€»è¾‘
    return await this.usersRepo.findAll();
  }
}

// Repository å±‚
@Injectable()
export class UsersRepository {
  async findAll() {
    // æ•°æ®è®¿é—®
    return await this.dataSource.query('SELECT * FROM users');
  }
}
```

### 3.2 æ¨¡å—åŒ–è®¾è®¡

#### æ¨¡å—åˆ’åˆ†åŸåˆ™

**1. æŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†**

```
apps/backend/src/
â”œâ”€â”€ auth/              # è®¤è¯æˆæƒæ¨¡å—
â”œâ”€â”€ users/             # ç”¨æˆ·ç®¡ç†æ¨¡å—
â”œâ”€â”€ assets/            # èµ„æºç®¡ç†æ¨¡å—
â””â”€â”€ common/            # å…¬å…±æ¨¡å—
```

**2. æŒ‰æŠ€æœ¯å±‚æ¬¡åˆ’åˆ†**

```
common/
â”œâ”€â”€ storage/           # å­˜å‚¨æŠ€æœ¯æ¨¡å—
â”œâ”€â”€ filters/           # è¿‡æ»¤å™¨æ¨¡å—
â”œâ”€â”€ interceptors/      # æ‹¦æˆªå™¨æ¨¡å—
â””â”€â”€ types/             # ç±»å‹å®šä¹‰æ¨¡å—
```

**3. æ¨¡å—ç‹¬ç«‹æ€§**

```typescript
// auth.module.ts - ç‹¬ç«‹æ¨¡å—
@Module({
  imports: [DatabaseModule],
  controllers: [AuthController],
  providers: [AuthService, AuthSessionsService],
  exports: [AuthService], // å¯¼å‡ºä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨
})
export class AuthModule {}

// users.module.ts - ä¾èµ– Auth æ¨¡å—
@Module({
  imports: [AuthModule], // å¯¼å…¥ Auth æ¨¡å—
  controllers: [UsersController],
  providers: [UsersService, UsersRepository],
})
export class UsersModule {}
```

### 3.3 ä»“å‚¨æ¨¡å¼ï¼ˆRepository Patternï¼‰

#### ä»€ä¹ˆæ˜¯ä»“å‚¨æ¨¡å¼

**ä»“å‚¨æ¨¡å¼**ï¼šå°†æ•°æ®è®¿é—®é€»è¾‘å°è£…åœ¨å•ç‹¬çš„ä»“å‚¨å¯¹è±¡ä¸­ï¼Œä¸šåŠ¡å±‚é€šè¿‡ä»“å‚¨æ¥å£è®¿é—®æ•°æ®ã€‚

```mermaid
graph LR
    A[Service] -->|ä¾èµ–| B[IRepository Interface]
    C[MySQL Repository] -.å®ç°.-> B
    D[PostgreSQL Repository] -.å®ç°.-> B
    E[MongoDB Repository] -.å®ç°.-> B
```

**ä¼˜åŠ¿**ï¼š

- è§£è€¦ï¼šä¸šåŠ¡é€»è¾‘ä¸æ•°æ®è®¿é—®è§£è€¦
- å¯æµ‹è¯•ï¼šæ˜“äº Mock ä»“å‚¨è¿›è¡Œå•å…ƒæµ‹è¯•
- å¯æ›¿æ¢ï¼šåˆ‡æ¢æ•°æ®åº“åªéœ€å®ç°æ–°ä»“å‚¨

**SnapMatch å®ç°**ï¼š

```typescript
// 1. å®šä¹‰ä»“å‚¨æ¥å£
// users/users.repository.ts
export interface IUsersRepository {
  findById(id: string): Promise<User | null>;
  findByUsername(username: string): Promise<User | null>;
  create(data: CreateUserData): Promise<User>;
  update(id: string, data: UpdateUserData): Promise<User>;
  delete(id: string): Promise<void>;
}

// 2. MySQL å®ç°
// users/users.repository.mysql.ts
@Injectable()
export class UsersRepository implements IUsersRepository {
  constructor(@InjectDataSource() private readonly dataSource: DataSource) {}

  async findById(id: string): Promise<User | null> {
    const result = await this.dataSource.query('SELECT * FROM rbac_users WHERE id = ?', [id]);
    return result[0] || null;
  }

  // å…¶ä»–æ–¹æ³•...
}

// 3. åœ¨ Service ä¸­ä½¿ç”¨
// users/users.service.ts
@Injectable()
export class UsersService {
  constructor(
    // ä¾èµ–æ¥å£ï¼Œè€Œéå…·ä½“å®ç°
    @Inject('IUsersRepository')
    private readonly usersRepo: IUsersRepository,
  ) {}

  async findOne(id: string) {
    return await this.usersRepo.findById(id);
  }
}

// 4. åœ¨ Module ä¸­æ³¨å†Œ
// users/users.module.ts
@Module({
  providers: [
    UsersService,
    {
      provide: 'IUsersRepository',
      useClass: UsersRepository, // å¯ä»¥è½»æ¾åˆ‡æ¢å®ç°
    },
  ],
})
export class UsersModule {}
```

### 3.4 ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

#### å­˜å‚¨æä¾›å•†ç­–ç•¥

**åº”ç”¨åœºæ™¯**ï¼šæ”¯æŒå¤šç§äº‘å­˜å‚¨ï¼ˆR2ã€S3ã€OSSï¼‰

```typescript
// 1. å®šä¹‰ç­–ç•¥æ¥å£
// common/storage/storage.interface.ts
export interface IMultipartUploadProvider {
  generatePresignedUploadUrl(key: string, options?: UploadOptions): Promise<string>;

  completeMultipartUpload(key: string, uploadId: string): Promise<void>;
}

// 2. R2 ç­–ç•¥å®ç°
// common/storage/providers/r2.provider.ts
@Injectable()
export class R2StorageProvider implements IMultipartUploadProvider {
  private client: S3Client;

  async generatePresignedUploadUrl(key: string) {
    // R2 ç‰¹å®šå®ç°
    const command = new PutObjectCommand({
      /* ... */
    });
    return await getSignedUrl(this.client, command);
  }
}

// 3. S3 ç­–ç•¥å®ç°
// common/storage/providers/s3.provider.ts
@Injectable()
export class S3StorageProvider implements IMultipartUploadProvider {
  private client: S3Client;

  async generatePresignedUploadUrl(key: string) {
    // S3 ç‰¹å®šå®ç°
    const command = new PutObjectCommand({
      /* ... */
    });
    return await getSignedUrl(this.client, command);
  }
}

// 4. Storage Service ä½¿ç”¨ç­–ç•¥
// common/storage/storage.service.ts
@Injectable()
export class StorageService {
  private provider: IMultipartUploadProvider;

  constructor() {
    // æ ¹æ®é…ç½®é€‰æ‹©ç­–ç•¥
    const providerType = process.env.STORAGE_PROVIDER;
    if (providerType === 'r2') {
      this.provider = new R2StorageProvider();
    } else if (providerType === 's3') {
      this.provider = new S3StorageProvider();
    }
  }

  async uploadFile(key: string, file: File) {
    // ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£ï¼Œä¸å…³å¿ƒå…·ä½“å®ç°
    return await this.provider.generatePresignedUploadUrl(key);
  }
}
```

**ä¼˜åŠ¿**ï¼š

- å¼€é—­åŸåˆ™ï¼šæ–°å¢å­˜å‚¨æ–¹å¼æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- è¿è¡Œæ—¶åˆ‡æ¢ï¼šå¯æ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©ç­–ç•¥
- æ˜“äºæµ‹è¯•ï¼šå¯ä»¥æ³¨å…¥ Mock ç­–ç•¥

### 3.5 ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰

#### NestJS DI ç³»ç»Ÿ

**1. Provider æ³¨å†Œ**

```typescript
@Module({
  providers: [
    // æ–¹å¼ 1ï¼šç›´æ¥æ³¨å†Œç±»
    UsersService,

    // æ–¹å¼ 2ï¼šä½¿ç”¨å­—ç¬¦ä¸² Token
    {
      provide: 'USERS_REPOSITORY',
      useClass: UsersRepository,
    },

    // æ–¹å¼ 3ï¼šä½¿ç”¨å€¼
    {
      provide: 'APP_CONFIG',
      useValue: { apiUrl: 'http://localhost:3000' },
    },

    // æ–¹å¼ 4ï¼šä½¿ç”¨å·¥å‚
    {
      provide: 'DATABASE_CONNECTION',
      useFactory: async (configService: ConfigService) => {
        return await createConnection(configService.get('DATABASE_URL'));
      },
      inject: [ConfigService],
    },
  ],
})
export class UsersModule {}
```

**2. ä¾èµ–æ³¨å…¥**

```typescript
// æ„é€ å‡½æ•°æ³¨å…¥
@Injectable()
export class UsersService {
  constructor(
    private readonly usersRepo: IUsersRepository,
    private readonly configService: ConfigService,
  ) {}
}

// å±æ€§æ³¨å…¥ï¼ˆä¸æ¨èï¼‰
@Injectable()
export class UsersService {
  @Inject('USERS_REPOSITORY')
  private readonly usersRepo: IUsersRepository;
}
```

**3. ç”Ÿå‘½å‘¨æœŸ**

```typescript
@Injectable()
export class UsersService implements OnModuleInit, OnModuleDestroy {
  async onModuleInit() {
    // æ¨¡å—åˆå§‹åŒ–æ—¶è°ƒç”¨
    console.log('UsersService initialized');
  }

  async onModuleDestroy() {
    // æ¨¡å—é”€æ¯æ—¶è°ƒç”¨
    console.log('UsersService destroyed');
  }
}
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸å¸¸è§é™·é˜±

### 4.1 æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

#### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰

**1. ä»ç®€åˆ°ç¹ï¼Œæ¸è¿›æ¼”è¿›**

```markdown
âœ… æ­£ç¡®åšæ³•ï¼š

- MVP é˜¶æ®µï¼šå•ä½“æ¶æ„ï¼Œæ¸…æ™°åˆ†å±‚
- æˆé•¿é˜¶æ®µï¼šæ¨¡å—åŒ–ï¼ŒæœåŠ¡åŒ–
- æˆç†Ÿé˜¶æ®µï¼šå¾®æœåŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰

âŒ é”™è¯¯åšæ³•ï¼š

- ä¸€å¼€å§‹å°±ä¸Šå¾®æœåŠ¡
- è¿‡åº¦è®¾è®¡ï¼Œå¢åŠ ä¸å¿…è¦çš„å¤æ‚åº¦
```

**2. æ¥å£éš”ç¦»ï¼Œä¾èµ–æŠ½è±¡**

```typescript
âœ… å¥½çš„è®¾è®¡ï¼š
interface IUsersRepository {
  findById(id: string): Promise<User>;
}

class UsersService {
  constructor(private repo: IUsersRepository) { }
}

âŒ å·®çš„è®¾è®¡ï¼š
class UsersService {
  constructor(private repo: MysqlUsersRepository) { }
}
```

**3. å•ä¸€èŒè´£ï¼Œè¾¹ç•Œæ¸…æ™°**

```typescript
âœ… å¥½çš„è®¾è®¡ï¼š
class UsersController {
  // åªå¤„ç† HTTP è¯·æ±‚
  async findAll() {
    return this.usersService.findAll();
  }
}

class UsersService {
  // åªå¤„ç†ä¸šåŠ¡é€»è¾‘
  async findAll() {
    return this.usersRepo.findAll();
  }
}

âŒ å·®çš„è®¾è®¡ï¼š
class UsersController {
  async findAll() {
    // ç›´æ¥åœ¨ Controller ä¸­æ“ä½œæ•°æ®åº“
    const result = await db.query('SELECT * FROM users');
    return result;
  }
}
```

**4. æå‰è€ƒè™‘æ‰©å±•æ€§**

```typescript
âœ… å¥½çš„è®¾è®¡ï¼š
// ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œæ˜“äºæ‰©å±•
interface IStorageProvider {
  upload(file: File): Promise<string>;
}

// æœªæ¥å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„å­˜å‚¨æä¾›å•†
class OSSStorageProvider implements IStorageProvider { }
class MinioStorageProvider implements IStorageProvider { }

âŒ å·®çš„è®¾è®¡ï¼š
// ç¡¬ç¼–ç ï¼Œéš¾ä»¥æ‰©å±•
class StorageService {
  async upload(file: File) {
    if (provider === 'r2') {
      // R2 ç‰¹å®šä»£ç 
    } else if (provider === 's3') {
      // S3 ç‰¹å®šä»£ç 
    }
    // æ¯æ¬¡æ–°å¢éƒ½è¦ä¿®æ”¹è¿™é‡Œ
  }
}
```

**5. æ¶æ„æ–‡æ¡£åŒ–**

```markdown
âœ… æ¨èåšæ³•ï¼š

- ç»˜åˆ¶æ¶æ„å›¾ï¼ˆC4 Modelï¼‰
- ç¼–å†™æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰
- ç»´æŠ¤ API æ–‡æ¡£ï¼ˆSwaggerï¼‰
- è®°å½•æ•°æ®æµå’Œå…³é”®æµç¨‹

âŒ é”™è¯¯åšæ³•ï¼š

- åªæœ‰ä»£ç ï¼Œæ²¡æœ‰æ–‡æ¡£
- æ¶æ„å†³ç­–ä¸è®°å½•åŸå› 
- API å˜æ›´ä¸æ›´æ–°æ–‡æ¡£
```

### 4.2 å¸¸è§æ¶æ„é™·é˜±

#### âŒ DON'Tï¼ˆå¸¸è§é”™è¯¯ï¼‰

**1. è¿‡åº¦åˆ†å±‚ï¼ˆOver-Engineeringï¼‰**

```typescript
âŒ å·®çš„åšæ³•ï¼š
Controller â†’ Service â†’ Manager â†’ Handler â†’ DAO â†’ Database
// å±‚æ¬¡è¿‡å¤šï¼Œå¢åŠ å¤æ‚åº¦ï¼Œé™ä½æ€§èƒ½

âœ… å¥½çš„åšæ³•ï¼š
Controller â†’ Service â†’ Repository â†’ Database
// ä¸‰å±‚æ¶æ„è¶³å¤Ÿæ¸…æ™°
```

**2. å¾ªç¯ä¾èµ–**

```typescript
âŒ å·®çš„åšæ³•ï¼š
// A ä¾èµ– B
class ModuleA {
  constructor(private readonly b: ModuleB) { }
}

// B åˆä¾èµ– A
class ModuleB {
  constructor(private readonly a: ModuleA) { }
}

âœ… å¥½çš„åšæ³•ï¼š
// æå–å…¬å…±ä¾èµ–åˆ° Module C
class ModuleA {
  constructor(private readonly c: ModuleC) { }
}

class ModuleB {
  constructor(private readonly c: ModuleC) { }
}
```

**3. ä¸Šå¸å¯¹è±¡ï¼ˆGod Objectï¼‰**

```typescript
âŒ å·®çš„åšæ³•ï¼š
class UserManager {
  // åŒ…å«æ‰€æœ‰ç”¨æˆ·ç›¸å…³åŠŸèƒ½
  login() { }
  register() { }
  uploadAvatar() { }
  updateProfile() { }
  deleteAccount() { }
  resetPassword() { }
  changeEmail() { }
  // ... 100 more methods
}

âœ… å¥½çš„åšæ³•ï¼š
// èŒè´£åˆ†ç¦»
class AuthService {
  login() { }
  register() { }
}

class ProfileService {
  updateProfile() { }
  uploadAvatar() { }
}

class AccountService {
  deleteAccount() { }
  resetPassword() { }
}
```

**4. è´«è¡€æ¨¡å‹ï¼ˆAnemic Domain Modelï¼‰**

```typescript
âŒ å·®çš„åšæ³•ï¼š
// Entity åªæœ‰ getter/setterï¼Œæ²¡æœ‰è¡Œä¸º
class User {
  id: string;
  username: string;
  password: string;
  email: string;
}

// æ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½åœ¨ Service ä¸­
class UsersService {
  async changePassword(userId: string, newPassword: string) {
    const user = await this.repo.findById(userId);
    user.password = newPassword;  // ç›´æ¥ä¿®æ”¹
    await this.repo.update(user);
  }
}

âœ… å¥½çš„åšæ³•ï¼š
// Entity åŒ…å«ä¸šåŠ¡è¡Œä¸º
class User {
  id: string;
  private _password: string;

  changePassword(newPassword: string, oldPassword: string) {
    if (!this.verifyPassword(oldPassword)) {
      throw new Error('Invalid old password');
    }
    this._password = this.hashPassword(newPassword);
  }
}

class UsersService {
  async changePassword(userId: string, newPassword: string) {
    const user = await this.repo.findById(userId);
    user.changePassword(newPassword, oldPassword);  // å°è£…åœ¨ Entity ä¸­
    await this.repo.update(user);
  }
}
```

**5. å¿½è§†éåŠŸèƒ½æ€§éœ€æ±‚**

```markdown
âŒ é”™è¯¯åšæ³•ï¼š

- åªå…³æ³¨åŠŸèƒ½å®ç°
- å¿½ç•¥æ€§èƒ½ã€å®‰å…¨ã€å¯ç»´æŠ¤æ€§
- æŠ€æœ¯å€ºåŠ¡ä¸è®°å½•

âœ… æ­£ç¡®åšæ³•ï¼š

- æ—©æœŸå®šä¹‰æ€§èƒ½ç›®æ ‡
- å®‰å…¨è®¾è®¡ä»å¼€å§‹
- æ¶æ„è¯„å®¡åŒ…å«éåŠŸèƒ½æ€§éœ€æ±‚
```

### 4.3 æ¶æ„æ¼”è¿›ç­–ç•¥

#### æ¼”è¿›è·¯å¾„

```mermaid
graph LR
    A[å•ä½“åº”ç”¨] -->|æ¨¡å—åŒ–| B[æ¨¡å—åŒ–å•ä½“]
    B -->|æœåŠ¡åŒ–| C[æœåŠ¡åŒ–æ¶æ„]
    C -->|å¾®æœåŠ¡| D[å¾®æœåŠ¡æ¶æ„]
```

**é˜¶æ®µ 1ï¼šå•ä½“åº”ç”¨ï¼ˆMVPï¼‰**

```markdown
ç‰¹ç‚¹ï¼š

- å•ä¸€ä»£ç åº“
- å•ä¸€æ•°æ®åº“
- ç»Ÿä¸€éƒ¨ç½²

é€‚ç”¨åœºæ™¯ï¼š

- å›¢é˜Ÿè§„æ¨¡ < 5 äºº
- ç”¨æˆ·é‡ < 10,000
- åŠŸèƒ½ç®€å•
```

**é˜¶æ®µ 2ï¼šæ¨¡å—åŒ–å•ä½“**

```markdown
ç‰¹ç‚¹ï¼š

- æ¨¡å—è¾¹ç•Œæ¸…æ™°
- å…±äº«æ•°æ®åº“
- ç‹¬ç«‹éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

SnapMatch å½“å‰é˜¶æ®µï¼š
âœ… æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼ˆauthã€usersã€assetsï¼‰
âœ… åˆ†å±‚æ¶æ„ï¼ˆController â†’ Service â†’ Repositoryï¼‰
âœ… ä¾èµ–æ³¨å…¥ï¼Œæ¥å£éš”ç¦»
```

**é˜¶æ®µ 3ï¼šæœåŠ¡åŒ–æ¶æ„**

```markdown
ç‰¹ç‚¹ï¼š

- å‰åç«¯åˆ†ç¦»
- API ç½‘å…³
- æœåŠ¡ç‹¬ç«‹éƒ¨ç½²

è§¦å‘æ¡ä»¶ï¼š

- å›¢é˜Ÿè§„æ¨¡ > 10 äºº
- ç”¨æˆ·é‡ > 100,000
- æ€§èƒ½ç“¶é¢ˆå‡ºç°
```

**é˜¶æ®µ 4ï¼šå¾®æœåŠ¡æ¶æ„**

```markdown
ç‰¹ç‚¹ï¼š

- æœåŠ¡æ‹†åˆ†
- ç‹¬ç«‹æ•°æ®åº“
- ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•

âš ï¸ è°¨æ…ä½¿ç”¨ï¼š

- å¢åŠ å¤æ‚åº¦
- åˆ†å¸ƒå¼äº‹åŠ¡
- è¿ç»´æˆæœ¬é«˜
```

### 4.4 æ¶æ„è¯„å®¡æ–¹æ³•

#### è¯„å®¡æ¸…å•

**1. åŠŸèƒ½æ€§**

- [ ] æ˜¯å¦æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Ÿ
- [ ] æ˜¯å¦æœ‰æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼Ÿ
- [ ] æ¥å£è®¾è®¡æ˜¯å¦åˆç†ï¼Ÿ

**2. éåŠŸèƒ½æ€§**

- [ ] æ€§èƒ½ï¼šæ˜¯å¦æ»¡è¶³æ€§èƒ½æŒ‡æ ‡ï¼Ÿ
- [ ] å®‰å…¨ï¼šæ˜¯å¦æœ‰å®‰å…¨è®¾è®¡ï¼Ÿ
- [ ] å¯æ‰©å±•æ€§ï¼šæ˜¯å¦æ”¯æŒåŠŸèƒ½æ‰©å±•ï¼Ÿ
- [ ] å¯ç»´æŠ¤æ€§ï¼šä»£ç æ˜¯å¦æ˜“äºç†è§£ï¼Ÿ

**3. æŠ€æœ¯é€‰å‹**

- [ ] æŠ€æœ¯æ ˆæ˜¯å¦åˆç†ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å¤‡é€‰æ–¹æ¡ˆï¼Ÿ
- [ ] å›¢é˜Ÿæ˜¯å¦ç†Ÿæ‚‰ï¼Ÿ

**4. æ¶æ„åŸåˆ™**

- [ ] æ˜¯å¦ç¬¦åˆ SOLID åŸåˆ™ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–ï¼Ÿ
- [ ] æ˜¯å¦è¿‡åº¦è®¾è®¡ï¼Ÿ

#### æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰

**æ¨¡æ¿**ï¼š

```markdown
# ADR-001: é€‰æ‹© NestJS ä½œä¸ºåç«¯æ¡†æ¶

## çŠ¶æ€

å·²æ¥å—

## ä¸Šä¸‹æ–‡

æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªåç«¯æ¡†æ¶æ¥æ„å»º SnapMatch çš„ API æœåŠ¡ã€‚

## å†³ç­–

ä½¿ç”¨ NestJS æ¡†æ¶ã€‚

## åŸå› 

1. **TypeScript åŸç”Ÿ**ï¼šç±»å‹å®‰å…¨ï¼Œå¼€å‘ä½“éªŒå¥½
2. **ä¼ä¸šçº§æ¶æ„**ï¼šå†…ç½® DIã€æ¨¡å—åŒ–ã€å®ˆå«ç­‰
3. **ç”Ÿæ€ä¸°å¯Œ**ï¼šä¸ TypeORMã€GraphQL ç­‰é›†æˆè‰¯å¥½
4. **å›¢é˜Ÿç†Ÿæ‚‰**ï¼šå›¢é˜Ÿæœ‰ Express/NestJS ç»éªŒ

## åæœ

**æ­£é¢**ï¼š

- å¼€å‘æ•ˆç‡é«˜
- ä»£ç ç»“æ„æ¸…æ™°
- æ˜“äºæµ‹è¯•

**è´Ÿé¢**ï¼š

- å­¦ä¹ æ›²çº¿è¾ƒé™¡
- ç›¸å¯¹è¾ƒé‡ï¼ˆå¯¹ç®€å•é¡¹ç›®ï¼‰
```

---

## ğŸ“š å‚è€ƒèµ„æº

### æ¨èä¹¦ç±

1. **ã€Šè½¯ä»¶æ¶æ„æ¨¡å¼ã€‹** - Kent Beck
   - åˆ†å±‚æ¶æ„
   - å¾®æœåŠ¡æ¶æ„
   - äº‹ä»¶é©±åŠ¨æ¶æ„

2. **ã€Šæ•´æ´æ¶æ„ã€‹** - Robert C. Martin
   - ä¾èµ–å€’ç½®åŸåˆ™
   - è¾¹ç•Œåˆ’åˆ†
   - æ•°æ®åº“æ— å…³

3. **ã€Šä¼ä¸šåº”ç”¨æ¶æ„æ¨¡å¼ã€‹** - Martin Fowler
   - åˆ†å±‚æ¶æ„
   - ä»“å‚¨æ¨¡å¼
   - é¢†åŸŸæ¨¡å‹

### åœ¨çº¿èµ„æº

- [NestJS å®˜æ–¹æ–‡æ¡£](https://docs.nestjs.com/)
- [Next.js å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [C4 æ¨¡å‹æ¶æ„å›¾](https://c4model.com/)
- [æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰](https://adr.github.io/)

### å·¥å…·æ¨è

- **æ¶æ„å›¾**ï¼šMermaidã€Draw.ioã€Lucidchart
- **API æ–‡æ¡£**ï¼šSwagger/OpenAPI
- **ä»£ç åˆ†æ**ï¼šSonarQubeã€Dependency Cruiser
- **æ€§èƒ½åˆ†æ**ï¼šClinic.jsã€Chrome DevTools

---

## ğŸ“ ç»ƒä¹ é¢˜

### ç»ƒä¹  1ï¼šè®¾è®¡æ¨¡å—åŒ–æ¶æ„

**ä»»åŠ¡**ï¼šä¸ºä¸€ä¸ª"åœ¨çº¿æ•™è‚²å¹³å°"è®¾è®¡æ¨¡å—åŒ–æ¶æ„

**è¦æ±‚**ï¼š

1. è¯†åˆ«æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼ˆè‡³å°‘ 5 ä¸ªï¼‰
2. è®¾è®¡æ¨¡å—ä¹‹é—´çš„å…³ç³»
3. ç”»å‡ºæ¨¡å—ä¾èµ–å›¾
4. å®šä¹‰æ¯ä¸ªæ¨¡å—çš„èŒè´£

**æç¤º**ï¼š

- è€ƒè™‘ç”¨æˆ·ã€è¯¾ç¨‹ã€è®¢å•ã€æ”¯ä»˜ã€è¯„ä»·ç­‰æ¨¡å—
- æ€è€ƒæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»
- é¿å…å¾ªç¯ä¾èµ–

### ç»ƒä¹  2ï¼šå®ç°ä»“å‚¨æ¨¡å¼

**ä»»åŠ¡**ï¼šä¸º"äº§å“ç®¡ç†"åŠŸèƒ½å®ç°ä»“å‚¨æ¨¡å¼

**è¦æ±‚**ï¼š

1. å®šä¹‰ `IProductsRepository` æ¥å£
2. å®ç° `MysqlProductsRepository`
3. åœ¨ `ProductsService` ä¸­ä½¿ç”¨ä»“å‚¨
4. ç¼–å†™å•å…ƒæµ‹è¯•

**æç¤º**ï¼š

- æ¥å£åº”åŒ…å« CRUD æ–¹æ³•
- Repository åªè´Ÿè´£æ•°æ®è®¿é—®
- Service åŒ…å«ä¸šåŠ¡é€»è¾‘

### ç»ƒä¹  3ï¼šæ¶æ„è¯„å®¡

**ä»»åŠ¡**ï¼šè¯„å®¡ä»¥ä¸‹æ¶æ„è®¾è®¡

**åœºæ™¯**ï¼š

ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½åœ¨ Controller ä¸­ï¼Œæ²¡æœ‰ Service å±‚ï¼Œç›´æ¥åœ¨ Controller ä¸­æ“ä½œæ•°æ®åº“ã€‚

**è¦æ±‚**ï¼š

1. æŒ‡å‡ºæ¶æ„é—®é¢˜ï¼ˆè‡³å°‘ 3 ä¸ªï¼‰
2. è¯´æ˜ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ä¸å¥½
3. æå‡ºæ”¹è¿›æ–¹æ¡ˆ
4. ç”»å‡ºæ”¹è¿›åçš„æ¶æ„å›¾

---

## â­ï¸ ä¸‹ä¸€èŠ‚

å®Œæˆæ¶æ„è®¾è®¡åï¼Œä¸‹ä¸€æ­¥æ˜¯[æ•°æ®åº“è®¾è®¡](./04-database-design.md)

åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ï¼š

- å¦‚ä½•è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
- è§„èŒƒåŒ–ä¸åè§„èŒƒåŒ–
- ç´¢å¼•è®¾è®¡ç­–ç•¥
- æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

---

**è¿”å›é˜¶æ®µç›®å½•**ï¼š[README](./README.md)
**è¿”å›æ•™ç¨‹é¦–é¡µ**ï¼š[æ•™ç¨‹ç›®å½•](../README.md)
