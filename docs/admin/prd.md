---

# 摄影小程序管理后台产品需求文档 (PRD)

| 文档版本 | 修改日期 | 修改人 | 修改内容 |
| :--- | :--- | :--- | :--- |
| V1.0 | 202X-XX-XX | [你的名字] | 初始版本创建 |
| V1.1 | 2026-01-04 | AI | **基于用户澄清需求更新：** 简化角色模型（只保留管理员+客户）、明确选片标记为完整版（3种标记）、照片处理采用前端生成方案、不需要相册分组功能 |
| V1.2 | 2026-01-10 | AI | **补充工作台快捷入口页面详细需求：** 新增 4.1 章节,包含顶部导航栏、精选项目轮播、筛选工具栏、项目网格展示的完整功能说明、使用场景和技术实现要点 |

---

> **⚠️ 重要说明（2026-01-04 更新）**
>
> 本文档已根据实际业务需求进行调整。**已废弃的内容用删除线标记（~~删除线~~）保留，新增内容用粗体标记**。
>
> **关键决策**：
>
> - ✅ 角色简化：只保留 **摄影师/管理员** 和 **客户** 两种角色
> - ✅ 选片标记：采用**完整版**（喜欢、入册、精修）
> - ✅ 照片处理：采用**前端生成方案**（零额外费用）
> - ✅ 相册分组：不需要 Album
> - ✅ Viewer 链接：一个项目一个链接
>
> **详细说明请查看**: [数据模型设计文档](./data-model-design.md)

---

## 1. 项目背景与目标

### 1.1 项目背景

已开发一款面向C端用户的摄影展示与选片小程序。为了支撑小程序的运营，需要构建一个PC端管理后台。

### 1.2 项目目标

1.  **高效管理**：为摄影师/管理员提供作品发布、客片管理、订单处理的一站式工作台。
2.  **大屏选片**：为C端客户提供PC端Web访问入口，解决手机屏幕小、看不清细节的选片痛点。
3.  **权限控制**：通过RBAC（基于角色的访问控制）模型，确保管理员、员工、客户的数据安全与隔离。

---

## 2. 用户角色与权限 (RBAC设计)

> **📌 2026-01-04 更新**: 角色模型已简化，~~废弃的角色用删除线标记~~。

**实际采用的角色**（简化版）：

| 角色                        | 说明                   | 核心权限                                                                 |
| :-------------------------- | :--------------------- | :----------------------------------------------------------------------- |
| **摄影师/管理员** (`admin`) | 内部员工，拥有所有权限 | 项目管理、照片上传、选片链接生成、客户管理、系统设置等所有功能           |
| **客户** (`customer`)       | 外部用户 (C端)         | **受限视图**。通过选片链接访问，只能查看自己的照片、进行选片、加购、下载 |

---

**原始设计（已废弃，保留供参考）**：

| 角色                                   | 说明                | 核心权限                                                                         |
| :------------------------------------- | :------------------ | :------------------------------------------------------------------------------- |
| ~~**超级管理员** (Admin)~~             | ~~老板/系统拥有者~~ | ~~拥有所有权限，包括系统设置、账号分配、财务查看~~                               |
| ~~**摄影师/修图师** (`photographer`)~~ | ~~内部员工~~        | ~~仅能查看和管理指派给自己的项目/客片；上传原片、上传精修片~~                    |
| ~~**销售/客服** (`sales`)~~            | ~~内部员工~~        | ~~客户档案管理、订单跟进、查看项目进度，无删除照片权限~~                         |
| **客户** (`customer`)                  | 外部用户 (C端)      | **受限视图**。登录后仅能进入"我的选片台"，查看自己的照片、进行选片、加购、下载。 |

---

## 3. 功能模块架构图 (Information Architecture)

```text
管理后台
├── 1. 工作台 (Dashboard)
│   ├── 数据概览 (访问量/订单量/待办事项)
│   └── 快捷入口 (创建项目、上传照片、生成选片链接)
├── 2. 作品集管理 (用于小程序展示)
│   ├── 作品列表 (增删改查：上传作品集素材)
│   ├── 分类管理 (婚纱/写真/儿童等)
│   └── 轮播图配置
├── 3. 交付与选片管理 (核心业务)
│   ├── 项目创建 (关联客户)
│   ├── 照片库 (交付照片：原片上传/水印设置/分级)
│   ├── 选片链接生成/分享
│   └── 精修交付 (上传精修/客户确认)
├── 4. 客户与订单 (CRM)
│   ├── 客户档案
│   └── 订单列表 (状态流转)
├── 5. 客户PC选片端 (独立视图)
│   ├── 浏览照片 (大图/对比)
│   ├── 选片标记 (喜欢/入册/精修)
│   └── 提交选片
└── 6. 系统设置
    ├── 账号与权限
    ├── 存储配置
    └── 小程序配置
```

---

## 4. 详细功能需求说明

### 4.0 概念与范围澄清：作品集素材 vs 交付照片（必须区分）

为避免“上传图片”概念混淆，本系统把图片上传分为两类，分别属于不同模块、权限、存储策略与路由入口：

1. **作品集素材**（用于小程序展示/营销内容）
   - **归属模块**：4.3 作品集管理（CMS）
   - **典型内容**：作品图、作品封面、轮播图、视频封面等
   - **权限特征**：面向内部运营/管理员；不与客户选片项目绑定
   - **推荐路由入口（Admin）**：作品列表/编辑页中上传（例如：`/dashboard/portfolio/works`），轮播图在 `banners`

2. **交付照片**（用于客户选片/交付链路）
   - **归属模块**：4.4 交付与选片管理（照片库/精修交付）
   - **典型内容**：项目原片、预览图（带水印）、缩略图、精修交付图
   - **权限特征**：强数据隔离（项目/客户维度），原图私有；预览图可通过选片链接访问
   - **推荐路由入口（Admin）**：照片库（例如：`/dashboard/delivery/photos`），以及项目详情下的项目照片库（如后续增加）

> 实现建议（接口约定）：直传签名/STS 建议统一走一个 `POST /assets/sign`，并通过 `purpose` 区分"作品集素材/交付照片"；上传完成后的"确认入库/绑定业务"再按领域拆分（作品集素材确认、交付照片确认），避免把两类资产的权限与归档策略混用。

### 4.1 工作台 - 快捷入口页面 (`/dashboard/shortcuts`)

**功能定位**: 作为管理后台的首页,为摄影师/管理员提供最常用的功能快速访问入口,提升日常工作效率。

---

#### 4.1.1 顶部导航栏 (Navbar)

**核心功能**:

1. **全局搜索**
   - **搜索范围**: 支持搜索项目名称、客户姓名、照片文件名
   - **实时搜索建议**: 输入时展示匹配结果
   - **搜索结果卡片**: 显示项目名称、客户名称、项目状态
   - **快捷操作**: 搜索结果支持"查看项目"快速跳转
   - **搜索占位符**: "搜索项目、客户或照片..."

2. **新建项目按钮**
   - **位置**: 导航栏右侧
   - **样式**: 主色调按钮,带有 Plus 图标
   - **功能**: 快速创建新项目

**UI 规范**:

- 固定在页面顶部 (`sticky top-0`)
- 居中搜索框,最大宽度 `max-w-xl`
- 响应式布局,移动端适配

---

#### 4.1.2 精选项目轮播 (FeaturedProjects)

**功能描述**: 展示最需要关注的项目,采用轮播卡片形式。

**精选规则** (当前实现):

- 取项目列表的前 4 个项目作为精选项目
- **未来优化方向**:
  - 展示最近 7 天内活跃的项目
  - 优先展示状态为"选片中"、"修图中"的项目
  - 支持管理员手动标记"星标项目"

**卡片信息展示**:

- **项目封面**: 16:9 比例图片,支持缩放动画
- **项目标签**: 显示项目类型/描述
- **状态标签**: 显示项目当前状态(如"进行中"、"选片中")
- **项目名称**: 大标题展示
- **照片数量**: 显示项目包含的照片总数

**交互功能**:

- 鼠标悬停: 图片缩放 + 遮罩层加深
- 左右切换: 支持轮播前后翻页
- 循环播放: `loop: true`
- 点击卡片: 跳转到项目详情页 (TODO)

**UI 规范**:

- 每个卡片宽度: 450px (md/lg 断点)
- 渐变遮罩: 从底部到顶部,黑色半透明
- 操作提示: 悬停时显示箭头按钮

---

#### 4.1.3 筛选与工具栏 (FilterBar)

**状态筛选标签**:

| 筛选项     | 说明           | 包含的项目状态                                                  |
| ---------- | -------------- | --------------------------------------------------------------- |
| **全部**   | 显示所有项目   | 所有状态                                                        |
| **进行中** | 尚未完成的项目 | PENDING, SELECTING, SUBMITTED, RETOUCHING, PENDING_CONFIRMATION |
| **选片中** | 客户正在选片   | SELECTING                                                       |
| **修图中** | 修图师正在处理 | RETOUCHING                                                      |
| **已交付** | 项目已完成     | DELIVERED                                                       |

**UI 交互**:

- 使用 Tabs 组件实现
- 激活状态: 底部 2px 下划线动画
- 支持横向滚动 (移动端)

**辅助工具**:

1. **排序下拉** (当前 UI 占位)
   - 日期排序: 最新创建 / 最早创建
   - 类型排序: 套餐类型
   - 状态排序: 项目状态

2. **视图切换**
   - 网格视图 (Grid): 默认视图,卡片网格布局
   - 列表视图 (List): 表格列表布局 (TODO)
   - 切换按钮: 图标 + 文字标签

---

#### 4.1.4 项目网格展示 (ProjectGrid)

**功能描述**: 根据筛选条件,以网格卡片形式展示项目列表。

**卡片信息**:

- 项目封面图
- 项目名称
- 客户姓名
- 项目状态徽章
- 照片数量
- 创建日期/拍摄日期

**响应式布局**:

```css
grid-cols-1      /* 移动端: 1列 */
sm:grid-cols-2   /* 小屏: 2列 */
lg:grid-cols-3   /* 中屏: 3列 */
xl:grid-cols-4   /* 大屏: 4列 */
```

**状态处理**:

1. **加载状态**: 居中显示 Spinner + "加载中..."
2. **错误状态**: 显示错误信息 + "重试"按钮
3. **空状态**: 显示"暂无项目"提示

**数据获取**:

- **API 接口**: `GET /admin/api/projects`
- **响应格式**: Envelope 包装 `{ code, message, data, timestamp }`
- **筛选逻辑**: 前端根据 `activeFilter` 过滤项目状态

---

#### 4.1.5 使用场景与用户价值

**典型使用场景**:

1. **每日工作启动**
   - 摄影师打开后台 → 首页看到"精选项目"轮播
   - 快速了解今天需要跟进的项目状态
   - 通过搜索框查找特定客户或项目

2. **项目状态跟进**
   - 点击"选片中"标签 → 查看所有待处理选片
   - 点击"修图中"标签 → 查看修图进度
   - 一目了然掌握所有项目状态

3. **快速创建项目**
   - 点击右上角"新建项目"按钮
   - 无需进入项目管理页面,直接创建

4. **项目查找**
   - 输入客户姓名或项目名称
   - 实时搜索结果 + 快速跳转

**用户价值**:

- ✅ **效率提升**: 减少导航层级,高频功能一步到位
- ✅ **状态可视**: 轮播 + 网格双重视图,项目状态一目了然
- ✅ **快速响应**: 搜索 + 筛选组合,秒级定位目标项目
- ✅ **工作流优化**: 从"查看状态"到"处理任务"的路径最短化

---

#### 4.1.6 技术实现要点

**前端技术栈**:

- Next.js 15 (App Router)
- React 19 (Client Components)
- Framer Motion (动画效果)
- shadcn/ui (UI 组件库)

**关键组件**:

- `Navbar` - 顶部导航栏
- `FeaturedProjects` - 精选项目轮播
- `FilterBar` - 筛选工具栏
- `ProjectGrid` - 项目网格
- `ProjectCard` - 项目卡片 (子组件)

**性能优化**:

- 轮播图懒加载
- 项目图片 WebP 格式
- 虚拟滚动 (如果项目数量 > 100)

**可访问性**:

- 键盘导航支持
- ARIA 标签
- 焦点管理

---

### 4.2 登录与鉴权模块

- **功能描述**：支持账号密码登录（员工）和 微信扫码/手机号验证码登录（客户）。
- **逻辑**：
  - 系统根据登录账号判断角色。
  - 若是**员工**，进入完整的管理后台界面。
  - 若是**客户**，自动跳转至“沉浸式选片工作台”，屏蔽所有管理菜单，只显示该客户关联的项目数据。

### 4.3 作品集管理 (CMS)

- **发布作品**：支持多图上传、视频上传、富文本描述、关联标签（Tag）。
- **展示设置**：控制小程序端的首页推荐、排序。
- **SEO配置**：虽然是小程序，但可预留标题关键词字段用于搜索优化。

### 4.4 交付与选片管理 (核心业务)

这是摄影师使用频率最高的功能。

#### 4.4.1 创建项目

- **字段**：项目名称、拍摄日期、关联客户（手机号/微信）、套餐类型（如：精修10张，底片全送）。
- **权限设置**：设置该项目是否允许下载原图、是否开启防盗链水印、选片截止日期。

#### 4.4.2 照片上传与处理

> **📌 2026-01-04 更新**: 照片处理采用**前端生成方案**。

- **批量上传**：支持拖拽上传，支持断点续传（摄影原片很大，必须考虑稳定性）。
- **前端生成方案**（实际采用）：
  - 前端上传前使用 Canvas 处理图片：
    - `originalKey` - 原图（20MB）
    - `previewKey` - 预览图（1200x800，500KB，加水印）
    - `thumbKey` - 缩略图（200x200，50KB）
  - 一次性上传 3 个文件到 R2 对象存储
  - 后端只记录 3 个存储路径
  - **费用**：约 $0.31/月（只付 R2 存储费，零额外处理费用）
- ~~**后端处理方案**~~：~~后台上传后，系统自动生成带水印的"预览图"供小程序和客户PC端查看，原图加密存储~~
- **分组管理**：~~支持创建子相册（如：第一套服装、外景、内景）~~
  - **不需要 Album 功能**：所有照片平铺在一个列表中，简化实现

#### 4.4.3 选片进度监控

- **状态流转**：待选片 -> 客户选片中 -> 客户已提交 -> 修图师修图中 -> 待确认 -> 已交付。
- **通知**：当客户提交选片时，后台通知摄影师；当修图完成上传时，小程序通知客户。

### 4.5 客户PC选片端 (Client View)

这是专门给客户用的界面，设计需极简、高端。

- **瀑布流/大图模式**：支持按键盘方向键切换照片，空格键标记"喜欢"。
- **对比模式**：支持两张照片并排对比（纠结症客户刚需）。
- **选片逻辑**（实际采用：完整版 3 种标记）：
  - **喜欢（liked）**：客户快速浏览时标记喜欢，用于初步筛选
  - **入册（in_album）**：确定要放进相册的照片，有套餐张数限制
  - **精修（retouch）**：需要重点精修的照片，有套餐张数限制
  - **套餐约束示例**：
    - 套餐 A：精修 10 张 + 入册 30 张
    - 如果客户选了 15 张精修、35 张入册 → 需要额外付费
  - 实时显示：已选 X 张 / 套餐包涵 Y 张。
  - **加片引导**：如果选了 X > Y，提示需支付额外费用（支持生成加片订单二维码）。
- **提交确认**：客户点击"确认选片"后，锁定选择，不可再更改，后台状态更新。

~~**选片逻辑**（原始设计：简化版）~~：

- ~~实时显示：已选 X 张 / 套餐包涵 Y 张~~

### 4.6 订单与财务

- **订单同步**：同步小程序的支付订单。
- **线下录入**：支持管理员手动录入线下收款记录，修改订单状态。
- **二销管理**：记录选片阶段产生的额外加片费、相册制作费。

### 4.7 系统设置 (权限配置)

> **📌 2026-01-04 更新**: 角色简化后，系统设置模块简化。

- ~~**角色管理**~~：~~预设角色（管理员、摄影师、客户），支持自定义角色~~
- ~~**账号管理**~~：~~添加员工账号，分配角色~~
- **水印设置**：上传品牌Logo，设置水印透明度、位置（九宫格或全屏铺满）。
- **存储配置**：R2/S3 配置（存储桶名称、访问密钥等）。
- **套餐管理**：创建和编辑套餐（精修张数、入册张数、价格等）。

---

## 5. 非功能性需求 (技术指标)

> **📌 2026-01-04 更新**: 照片处理采用前端生成方案。

1.  **存储与带宽**：
    - 照片使用 CloudFlare R2 对象存储。
    - **CDN加速**：确保客户在小程序和PC端加载几百张照片时流畅无卡顿。
    - **前端生成缩略图**（实际采用）：
      - 前端上传前使用 Canvas 处理图片
      - 生成 3 种规格：原图（20MB）、预览图（500KB，带水印）、缩略图（50KB）
      - 一次性上传到 R2，后端只记录路径
      - **费用**：约 $0.31/月（1000 张照片）
    - ~~**缩略图服务**~~：~~上传一张原图（20MB），系统需自动生成 缩略图（列表用）、预览图（选片用，带水印）、原图（下载用）三种规格~~
2.  **安全性**：
    - **防爬虫/防盗图**：预览图强制加水印，禁用右键保存（PC端）。
    - **数据隔离**：客户A绝对不能通过修改URL参数访问到客户B的照片。
3.  **并发性**：
    - 考虑到是展示类，并发要求不高，但上传带宽要求高。

---

## 6. 交互设计建议 (UI/UX)

- **管理端风格**：建议使用 Ant Design Pro 或 Element Plus 等成熟的B端组件库，深色模式（Dark Mode）往往更受摄影师喜欢，因为更能凸显照片色彩。
- **客户选片端风格**：全屏沉浸式，黑色背景，操作按钮最小化，突出照片本身。

---

## 7. 总结与开发优先级

**P0 (必须有)**：

1.  管理员/摄影师登录。
2.  项目创建与照片批量上传（带水印处理）。
3.  小程序作品集内容配置。
4.  客户PC端访问链接生成及基本的选片功能。

**P1 (应该有)**：

1.  多级权限管理（老板vs员工）。
2.  选片加购逻辑（超出张数自动计算金额）。
3.  订单状态流转与通知。

**P2 (可以有)**：

1.  数据大屏（统计本月拍摄量、选片率）。
2.  修图师绩效统计。

---

**建议**：在开发“客户使用后台”这一功能时，技术上建议**不要**让客户进入真正的 Admin 系统，而是开发一个独立的 `viewer` 页面（例如 `admin.site.com/client/selection/{uuid}`），这样既保证了安全性，又能完全自定义客户的选片体验。
42.1s
