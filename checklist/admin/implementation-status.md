# SnapMatch 管理后台 - 实现状态跟踪

> **文档说明**: 本文档用于跟踪 PRD 功能的实现状态
>
> - ✅ `- [x]` : 已完成
> - ⬜ `- [ ]` : 未实现
> - 🟨 `- [ ]` : 部分实现（会标注原因）
> - 🚫 : 需求已砍掉/不做

**最后更新**: 2026-01-03
**PRD 文档**: [prd.md](./prd.md)
**详细拆解**: [discuss/admin/prd-breakdown-and-todos.md](../../discuss/admin/prd-breakdown-and-todos.md)

---

## 📊 总体进度

**已完成**: 约 15%（主要是基础框架）
**核心阻塞**: 数据模型未定义、照片处理后端逻辑未完成

---

## ✅ 已实现的功能

### 1. 登录与鉴权模块（完整）

- [x] 员工账号密码登录
- [x] JWT 会话管理（access/refresh token）
- [x] 路由保护（`proxy.ts` 保护 `/dashboard/*`）
- [x] RBAC 基础框架
- [x] 全局 401/403 处理
- [x] `GET /api/auth/me` - 获取当前用户信息
- [x] `POST /api/auth/login` - 登录
- [x] `POST /api/auth/logout` - 登出

**相关文件**:

- `apps/backend/src/auth/` - 后端认证模块
- `apps/admin/app/(guest)/login/page.tsx` - 登录页
- `apps/admin/proxy.ts` - 路由保护

---

### 2. 资产上传功能（部分实现）

- [x] 统一签名接口 `POST /api/assets/sign`
- [x] 前端上传组件（支持拖拽、并发、断点续传、分片上传）
- [x] S3 分片上传支持
- [x] 上传进度实时显示
- [x] 分片上传的断点续传
- [x] 并发控制（可配置 1-6）
- 🟨 上传完成确认接口（部分完成，业务数据入库未实现）

**相关文件**:

- `apps/backend/src/assets/` - 后端资产模块
- `apps/admin/components/features/upload/asset-upload.tsx` - 上传组件

**技术债务**:

- `apps/backend/src/assets/assets.service.ts` 中有 `TODO: 保存照片元数据到数据库（Photo 表）`

---

### 3. Admin 后台骨架

- [x] 侧边栏导航与布局
- [x] Tabbar 多标签页（支持拖拽排序、固定、关闭）
- [x] 基础 UI 组件库（Shadcn UI）
- [x] 全局状态管理（Zustand）
- [x] 路由权限过滤（菜单级）

**相关文件**:

- `apps/admin/app/dashboard/layout.tsx` - Dashboard 布局
- `apps/admin/lib/navigation/dashboard-tabs.ts` - Tabbar 管理
- `apps/admin/lib/store/app-store.ts` - 全局状态

---

## ❌ P0 级别 - 核心未实现功能（必须有）

### 1. 数据模型与数据库 🗄️

**状态**: 未开始
**优先级**: 🔴 最高（阻塞所有业务功能）

需要实现的核心实体：

#### 1.1 核心业务实体

- [ ] `Project` 实体 - 项目模型
  - 字段：id, name, shootDate, clientId, packageId, allowDownloadOriginal, watermarkEnabled, selectionDeadline, status, assignedStaffIds[]
  - 状态机：待选片 → 选片中 → 已提交 → 修图中 → 待确认 → 已交付
- [ ] `Album` 实体 - 相册/分组模型
  - 字段：id, projectId, name, sort
- [ ] `Photo` 实体 - 照片模型
  - 字段：id, projectId, albumId, filename, size, exif?, status(processing/ready/failed)
  - variants: { thumbUrl, previewUrl, originalKey, retouchedUrl? }
- [ ] `Selection` 实体 - 选片记录
  - 字段：id, projectId, clientId, status(draft/submitted/locked)
  - items: [{photoId, flags{liked,inAlbum,retouch}}]
  - submittedAt
- [ ] `ViewerLink` 实体 - 选片链接
  - 字段：id, projectId, token, expiresAt, revokedAt

#### 1.2 作品集管理实体

- [ ] `Work` 实体 - 作品集
  - 字段：id, title, coverAssetId, content, categoryId, tags[], status, sort, featured
- [ ] `Category` 实体 - 作品分类
  - 字段：id, name, slug, sort, description
- [ ] `Banner` 实体 - 轮播图配置
  - 字段：id, assetId, title?, link?, sort, startDate?, endDate?

#### 1.3 客户与订单实体

- [ ] `Customer` 实体 - 客户档案
  - 字段：id, name, phone, wechatOpenId?, email?, notes?, tags[]
- [ ] `Order` 实体 - 订单模型
  - 字段：id, projectId, type(package/extra/album/offline), amount, status, channel, externalTradeNo?, createdBy

#### 1.4 系统配置实体

- [ ] `WatermarkConfig` 实体 - 水印配置
  - 字段：id, logoAssetId, opacity, positionMode(grid/tile), updatedAt
- [ ] `AuditLog` 实体 - 操作日志
  - 字段：id, actorId, action, resourceType, resourceId, before?, after?, createdAt

**实现任务**:

- [ ] 创建所有实体定义（`apps/backend/src/database/entities/`）
- [ ] 创建 DTO 定义（request/response）
- [ ] 创建 Repository 层
- [ ] 编写数据库迁移脚本
- [ ] 初始化种子数据

**影响**: 所有业务功能的基础

---

### 2. 作品集管理（CMS）📸

**状态**: 页面框架存在，功能未实现
**优先级**: 🔴 高

#### 2.1 作品管理

- [ ] 作品 CRUD 接口
  - [ ] `GET /api/works` - 作品列表（分页、筛选、排序）
  - [ ] `POST /api/works` - 创建作品
  - [ ] `GET /api/works/:id` - 获取作品详情
  - [ ] `PATCH /api/works/:id` - 更新作品
  - [ ] `DELETE /api/works/:id` - 删除作品
- [ ] 作品内容编辑
  - [ ] 多图/视频上传集成（调用 `AssetUpload` 组件）
  - [ ] 富文本描述（标题、正文）
  - [ ] 标签关联与创建
  - [ ] 封面设置
- [ ] 作品发布管理
  - [ ] 上下架状态切换
  - [ ] 排序调整
  - [ ] 首页推荐开关
- [ ] 前端页面实现
  - [ ] 作品列表页（表格/卡片视图）
  - [ ] 作品编辑页（表单 + 上传 + 预览）
  - [ ] 删除确认对话框

**页面路径**: `/dashboard/portfolio/works`

#### 2.2 分类管理

- [ ] 分类 CRUD 接口
  - [ ] `GET /api/categories` - 分类列表
  - [ ] `POST /api/categories` - 创建分类
  - [ ] `PATCH /api/categories/:id` - 更新分类
  - [ ] `DELETE /api/categories/:id` - 删除分类
- [ ] 前端页面实现
  - [ ] 分类列表（表格）
  - [ ] 分类编辑表单
  - [ ] 拖拽排序

**页面路径**: `/dashboard/portfolio/categories`

#### 2.3 轮播图配置

- [ ] 轮播图 CRUD 接口
  - [ ] `GET /api/banners` - 轮播图列表
  - [ ] `POST /api/banners` - 创建轮播图
  - [ ] `PATCH /api/banners/:id` - 更新轮播图
  - [ ] `DELETE /api/banners/:id` - 删除轮播图
- [ ] 前端页面实现
  - [ ] 轮播图列表
  - [ ] 图片上传与预览
  - [ ] 拖拽排序
  - [ ] 生效日期范围设置

**页面路径**: `/dashboard/portfolio/banners`

---

### 3. 交付与选片管理 - 核心业务 🎯

**状态**: 部分页面框架存在，核心功能未实现
**优先级**: 🔴 最高

#### 3.1 项目创建与管理

**后端接口**:

- [ ] `GET /api/projects` - 项目列表（支持按角色/状态/客户筛选）
- [ ] `POST /api/projects` - 创建项目
- [ ] `GET /api/projects/:id` - 项目详情
- [ ] `PATCH /api/projects/:id` - 更新项目
- [ ] `DELETE /api/projects/:id` - 删除项目

**前端功能**:

- [ ] 项目列表页
  - [ ] 数据表格（分页、排序）
  - [ ] 筛选器（状态、日期、客户、摄影师）
  - [ ] 搜索功能
  - [ ] 快捷操作（查看、编辑、删除）
- [ ] 项目创建表单
  - [ ] 基础信息：项目名称、拍摄日期
  - [ ] 客户选择（关联或新建客户）
  - [ ] 套餐配置：精修张数、底片全送开关
  - [ ] 权限设置：
    - [ ] 允许下载原图开关
    - [ ] 水印开关
    - [ ] 选片截止日期
  - [ ] 人员指派：摄影师、修图师、销售
- [ ] 项目详情页
  - [ ] 项目信息展示
  - [ ] 状态流转可视化
  - [ ] 选片统计（已选 X / 套餐 Y）
  - [ ] 快捷入口（上传照片、生成选片链接）

**页面路径**:

- `/dashboard/delivery/projects` - 需创建
- `/dashboard/delivery/projects/new` - 页面存在，功能未实现
- `/dashboard/delivery/projects/[id]` - 需创建

#### 3.2 照片上传与处理

**后端接口**:

- [ ] `POST /api/photos/confirm` - 照片上传确认（业务数据入库）
  - [ ] 保存照片元数据到 Photo 表
  - [ ] 触发异步处理（缩略图、水印）
  - [ ] 返回处理任务 ID
- [ ] `GET /api/projects/:id/photos` - 照片列表（支持分组、分页）
- [ ] `PATCH /api/photos/:id` - 更新照片信息
- [ ] `DELETE /api/photos/:id` - 删除照片
- [ ] `POST /api/photos/batch-move` - 批量移动照片到其他分组

**异步处理服务**:

- [ ] 生成缩略图（列表用，约 200x200）
- [ ] 生成预览图（选片用，约 1200x800，强制水印）
- [ ] 原图加密/私有读（下载需鉴权 + 临时 URL）
- [ ] 处理状态回写（Photo.status: processing → ready/failed）
- [ ] EXIF 信息提取

**前端功能**:

- [ ] 照片库页面
  - [ ] 照片网格/列表视图切换
  - [ ] 分组展示（相册/子相册）
  - [ ] 照片筛选（原片/预览/精修、状态）
  - [ ] 批量操作
    - [ ] 批量选择
    - [ ] 批量标记
    - [ ] 批量移动到分组
    - [ ] 批量删除
- [ ] 上传集成
  - [ ] 调用 `AssetUpload` 组件（已完成）
  - [ ] 分组选择（上传前选择相册）
  - [ ] 上传进度与状态展示
  - [ ] 处理失败重试
- [ ] 相册管理
  - [ ] 创建/编辑/删除相册
  - [ ] 相册排序

**页面路径**: `/dashboard/delivery/photos` - 页面存在，功能未实现

#### 3.3 选片进度监控

**后端接口**:

- [ ] `GET /api/projects/:id/selection` - 选片详情
- [ ] `GET /api/projects/:id/selection/stats` - 选片统计

**前端功能**:

- [ ] 状态流转可视化
  - [ ] 状态步骤条：待选片 → 选片中 → 已提交 → 修图中 → 待确认 → 已交付
  - [ ] 状态变更时间线
- [ ] 选片统计卡片
  - [ ] 已选张数 / 套餐张数
  - [ ] 超额张数（如有）
  - [ ] 选片进度百分比
- [ ] 客户选片快照
  - [ ] 实时展示选片结果
  - [ ] 标记类型分布（喜欢/入册/精修）

**实现位置**: 项目详情页

#### 3.4 ViewerLink 管理

**后端接口**:

- [ ] `POST /api/projects/:id/viewer-link` - 生成/刷新选片链接
  - [ ] 生成唯一 token
  - [ ] 设置过期时间（可选）
  - [ ] 返回完整访问 URL
- [ ] `GET /api/projects/:id/viewer-links` - 查看项目所有链接
- [ ] `PATCH /api/viewer-links/:id/revoke` - 撤销链接
- [ ] `PATCH /api/viewer-links/:id/reset` - 重置链接（生成新 token）

**前端功能**:

- [ ] 链接列表展示
  - [ ] Token 显示
  - [ ] 创建时间
  - [ ] 过期时间
  - [ ] 访问次数
  - [ ] 状态（有效/已撤销/已过期）
- [ ] 链接操作
  - [ ] 复制链接到剪贴板
  - [ ] 生成二维码
  - [ ] 撤销链接
  - [ ] 重置链接
- [ ] 访问日志（可选）
  - [ ] 访问时间
  - [ ] IP 地址
  - [ ] 用户代理

**页面路径**: `/dashboard/delivery/viewer-links` - 页面存在，功能未实现

---

### 4. 客户 PC 选片端 💻

**状态**: 页面框架存在，核心功能未实现
**优先级**: 🔴 最高

#### 4.1 访问控制

**后端接口**:

- [ ] `GET /api/viewer/:token` - 获取选片信息
  - [ ] Token 校验与有效性检查
  - [ ] 过期时间检查
  - [ ] 撤销状态检查
  - [ ] 返回：项目信息、预览图列表、套餐规则、选片状态
- [ ] `GET /api/viewer/:token/photos` - 获取照片列表（分页）
  - [ ] 仅返回预览图（带水印）
  - [ ] 不暴露原图 URL

**前端功能**:

- [ ] Token 验证失败处理
  - [ ] 链接无效提示
  - [ ] 链接过期提示
  - [ ] 链接已撤销提示

#### 4.2 浏览模式

**后端接口**: 无（纯前端功能）

**前端功能**:

- [ ] 瀑布流视图
  - [ ] 响应式网格布局
  - [ ] 懒加载
  - [ ] 虚拟滚动（照片量大时）
- [ ] 大图模式
  - [ ] 全屏展示
  - [ ] 键盘方向键切换
  - [ ] 空格键标记"喜欢"
  - [ ] ESC 退出
- [ ] 对比模式
  - [ ] 两张照片并排展示
  - [ ] 快速切换对比照片
  - [ ] 同步缩放

**页面路径**:

- `/client/selection/[uuid]` - 主页面
- `/client/selection/[uuid]/browse` - 浏览页

#### 4.3 选片标记

**后端接口**:

- [ ] `PUT /api/viewer/:token/selection` - 保存选片草稿
  - [ ] 幂等操作（可重复调用）
  - [ ] 实时保存
  - [ ] 返回保存后的选片状态
- [ ] `POST /api/viewer/:token/submit` - 提交选片
  - [ ] 锁定选片（不可再修改）
  - [ ] 触发后端通知
  - [ ] 更新项目状态

**前端功能**:

- [ ] 标记类型
  - [ ] 喜欢（like）
  - [ ] 入册（inAlbum）
  - [ ] 精修（retouch）
- [ ] 标记操作
  - [ ] 点击标记切换
  - [ ] 批量标记
  - [ ] 标记计数实时更新
- [ ] 计数与限额
  - [ ] 实时显示：已选 X / 套餐 Y
  - [ ] 超额提示（X > Y 时）
  - [ ] 标记类型限额
- [ ] 提交确认
  - [ ] 确认对话框（展示选片统计）
  - [ ] 提交后锁定（禁用所有操作）
  - [ ] 成功页/提示
  - [ ] 后续步骤说明

**页面路径**:

- `/client/selection/[uuid]/mark` - 标记页
- `/client/selection/[uuid]/submit` - 提交页

#### 4.4 加片引导

**后端接口**:

- [ ] `POST /api/projects/:id/extras/order` - 生成加片订单
  - [ ] 超额计算规则
  - [ ] 单价配置
  - [ ] 返回支付信息（二维码/链接）

**前端功能**:

- [ ] 超额提示
  - [ ] 弹窗/横幅提示
  - [ ] 超额张数与金额
- [ ] 加购引导
  - [ ] 支付二维码展示
  - [ ] 支付链接跳转
  - [ ] 支付状态轮询
- [ ] 支付成功后
  - [ ] 更新套餐张数
  - [ ] 解除限额限制

**实现位置**: 选片标记页、提交确认页

#### 4.5 安全防护

**后端**:

- [ ] 预览图强制水印
- [ ] 原图访问权限控制（临时签名 URL）
- [ ] Token 防枚举（长随机字符串 + 签名）
- [ ] 访问频率限制（可选）

**前端**:

- [ ] 禁用右键菜单（弱防护）
- [ ] 禁用拖拽图片
- [ ] 不暴露原图 URL
- [ ] 水印覆盖展示

---

## ⚠️ P1 级别 - 重要未实现功能（应该有）

### 1. 多角色权限完善 🔐

**状态**: 基础 RBAC 存在，细粒度权限未实现
**优先级**: 🟡 中

#### 1.1 后端权限细化

- [ ] 数据隔离逻辑
  - [ ] `photographer` 仅查看被指派的项目
  - [ ] `sales` 仅查看负责客户的订单/项目
  - [ ] Repository 层自动过滤（基于当前用户角色）
- [ ] 细粒度权限点
  - [ ] `projects:read` / `projects:write` / `projects:delete`
  - [ ] `photos:upload` / `photos:read` / `photos:downloadOriginal`
  - [ ] `selections:read` / `selections:submit` / `selections:lock`
  - [ ] `orders:read` / `orders:write`
  - [ ] `settings:write`
- [ ] 权限 Guard 装饰器完善
  - [ ] `@Permissions()` Guard
  - [ ] 数据范围 Scope

#### 1.2 前端权限控制

- [ ] 按钮级权限控制
  - [ ] 基于 `me.permissions` 显示/隐藏按钮
  - [ ] 操作前的二次权限校验
- [ ] 数据范围提示
  - [ ] 摄影师登录时提示"仅显示指派项目"
  - [ ] 销售登录时提示"仅显示负责客户"

**当前状态**:

- ✅ 菜单级过滤已实现
- ❌ 按钮/操作级控制未实现

---

### 2. 通知系统 🔔

**状态**: 未实现
**优先级**: 🟡 中

#### 2.1 通知触发

**后端接口**:

- [ ] 通知服务模块
- [ ] 通知模板管理
- [ ] 通知触发逻辑
  - [ ] 客户提交选片 → 通知摄影师/修图师
  - [ ] 精修上传完成 → 通知客户
  - [ ] 项目状态变更 → 通知相关人员

#### 2.2 通知通道

**选择实现以下至少一种**:

- [ ] 小程序订阅消息（需要小程序配置）
- [ ] 短信通知（需要短信服务接入）
- [ ] 邮件通知（需要邮件服务接入）
- [ ] 站内消息（需要消息表 + 轮询/WebSocket）

#### 2.3 前端通知中心

- [ ] 通知图标与红点提示
- [ ] 通知列表
- [ ] 通知详情
- [ ] 标记已读
- [ ] 清空通知

---

### 3. 精修交付流程 ✨

**状态**: 页面存在，功能未实现
**优先级**: 🟡 中

#### 3.1 精修图上传

**后端接口**:

- [ ] `POST /api/projects/:id/retouched` - 上传精修图
  - [ ] 批量上传
  - [ ] 与选片结果对齐（只上传选中的照片）
  - [ ] 生成精修预览图（带水印）
  - [ ] 更新 Photo.retouchedUrl

**前端功能**:

- [ ] 精修上传页
  - [ ] 选片结果展示（对比参考）
  - [ ] 批量上传
  - [ ] 上传进度
  - [ ] 预览精修图

#### 3.2 客户确认

**后端接口**:

- [ ] `POST /api/projects/:id/retouched/confirm` - 客户确认
  - [ ] 更新项目状态为"已交付"
  - [ ] 触发通知

**前端功能**:

- [ ] 精修图预览页
  - [ ] 精修图展示
  - [ ] 确认按钮
  - [ ] 确认成功提示

**页面路径**: `/dashboard/delivery/retouch` - 页面存在，功能未实现

---

### 4. 加片订单与支付 💰

**状态**: 未实现
**优先级**: 🟡 中

#### 4.1 后端订单逻辑

**后端接口**:

- [ ] `POST /api/projects/:id/extras/order` - 生成加片订单
  - [ ] 超额计算（已选 - 套餐 = 超额）
  - [ ] 单价配置（每张精修价格）
  - [ ] 总价计算
  - [ ] 创建 Order 记录
  - [ ] 返回支付信息

#### 4.2 支付对接

**选择实现以下至少一种**:

- [ ] 微信支付（需要商户配置）
- [ ] 支付宝支付
- [ ] 线下支付（手动确认）

#### 4.3 前端支付流程

- [ ] 超额检测
  - [ ] 实时计算超额张数
  - [ ] 超额时弹窗提示
- [ ] 加购引导
  - [ ] 展示超额张数与金额
  - [ ] 生成支付二维码
  - [ ] 支付链接跳转
- [ ] 支付状态轮询
  - [ ] 定时检查支付状态
  - [ ] 支付成功后更新套餐张数

---

### 5. 订单管理 📋

**状态**: 页面存在，功能未实现
**优先级**: 🟡 中

#### 5.1 订单列表

**后端接口**:

- [ ] `GET /api/orders` - 订单列表
  - [ ] 分页、排序
  - [ ] 筛选（状态、类型、日期范围、客户）
  - [ ] 搜索（订单号、客户姓名）

**前端功能**:

- [ ] 订单列表页
  - [ ] 数据表格
  - [ ] 筛选器（状态、类型、日期）
  - [ ] 搜索框
  - [ ] 订单详情弹窗/抽屉

#### 5.2 订单详情

**后端接口**:

- [ ] `GET /api/orders/:id` - 订单详情
- [ ] `PATCH /api/orders/:id` - 更新订单

**前端功能**:

- [ ] 订单详情页
  - [ ] 基础信息（订单号、金额、状态、时间）
  - [ ] 关联项目信息
  - [ ] 关联客户信息
  - [ ] 支付信息
  - [ ] 状态流转按钮（如确认支付、发货）

#### 5.3 线下录入

**后端接口**:

- [ ] `POST /api/orders/offline` - 线下订单录入
  - [ ] 手动输入订单信息
  - [ ] 设置订单状态

**前端功能**:

- [ ] 线下订单录入表单
  - [ ] 客户选择
  - [ ] 订单类型（套餐/加片/相册/其他）
  - [ ] 金额输入
  - [ ] 备注说明

#### 5.4 订单同步

**后端任务**:

- [ ] 小程序支付订单同步
  - [ ] 监听支付回调
  - [ ] 同步到 Order 表
  - [ ] 更新项目状态

**页面路径**: `/dashboard/crm/orders` - 页面存在，功能未实现

---

### 6. ViewerLink 高级管理 ⚙️

**状态**: 未实现
**优先级**: 🟡 中

#### 6.1 链接管理

**后端接口**（已在 P0 中列出）:

- [ ] 链接列表与查询
- [ ] 撤销链接
- [ ] 重置链接
- [ ] 设置过期时间

**前端功能**:

- [ ] 链接管理页
  - [ ] 链接列表
  - [ ] 创建链接（配置过期时间）
  - [ ] 撤销操作
  - [ ] 重置操作
  - [ ] 复制链接/二维码

#### 6.2 访问统计

**后端接口**:

- [ ] `GET /api/viewer-links/:id/stats` - 链接访问统计
  - [ ] 访问次数
  - [ ] 提交次数
  - [ ] 访问时间分布

**前端功能**:

- [ ] 访问统计图表
  - [ ] 访问趋势图
  - [ ] 提交转化率

**页面路径**: `/dashboard/delivery/viewer-links` - 页面存在，功能未实现

---

## 📊 P2 级别 - 增强功能（可以有）

### 1. 数据大屏与统计 📈

**状态**: 未实现
**优先级**: 🟢 低

#### 1.1 Dashboard 概览

**后端接口**:

- [ ] `GET /api/analytics/overview` - 概览统计
  - [ ] 今日/本周/本月访问量
  - [ ] 订单量统计
  - [ ] 收入统计
  - [ ] 待办事项统计

**前端功能**:

- [ ] 数据卡片展示
  - [ ] 访问量卡片
  - [ ] 订单量卡片
  - [ ] 收入卡片
  - [ ] 待办事项卡片
- [ ] 快捷入口
  - [ ] 创建项目
  - [ ] 上传照片
  - [ ] 生成选片链接

**页面路径**: `/dashboard/analytics` - 页面存在，功能未实现

#### 1.2 项目统计

**后端接口**:

- [ ] `GET /api/analytics/projects` - 项目统计
  - [ ] 本月拍摄量
  - [ ] 项目状态分布
  - [ ] 选片率统计
  - [ ] 按摄影师统计

**前端功能**:

- [ ] 项目统计图表
  - [ ] 拍摄量趋势图
  - [ ] 状态分布饼图
  - [ ] 选片率柱状图

#### 1.3 收入统计

**后端接口**:

- [ ] `GET /api/analytics/revenue` - 收入统计
  - [ ] 按月统计
  - [ ] 按订单类型统计
  - [ ] 按摄影师统计

**前端功能**:

- [ ] 收入趋势图
- [ ] 收入构成饼图
- [ ] 按摄影师排名

#### 1.4 统计缓存

**后端任务**:

- [ ] 统计数据缓存
  - [ ] Redis 缓存热点数据
  - [ ] 定时任务更新缓存
  - [ ] 缓存失效策略

---

### 2. 修图师绩效统计 📊

**状态**: 未实现
**优先级**: 🟢 低

#### 2.1 绩效数据

**后端接口**:

- [ ] `GET /api/analytics/performers` - 绩效统计
  - [ ] 修图师列表
  - [ ] 处理项目数
  - [ ] 修片张数
  - [ ] 平均处理时长
  - [ ] 客户满意度（如有评价）

**前端功能**:

- [ ] 绩效排行榜
- [ ] 个人绩效详情
- [ ] 绩效趋势图

---

### 3. 客户档案管理 👥

**状态**: 页面存在，功能未实现
**优先级**: 🟢 低

#### 3.1 客户列表

**后端接口**:

- [ ] `GET /api/customers` - 客户列表
  - [ ] 分页、排序
  - [ ] 筛选（标签、注册时间）
  - [ ] 搜索（姓名、手机号）

**前端功能**:

- [ ] 客户列表页
  - [ ] 数据表格
  - [ ] 筛选器
  - [ ] 搜索框

#### 3.2 客户详情

**后端接口**:

- [ ] `GET /api/customers/:id` - 客户详情
- [ ] `PATCH /api/customers/:id` - 更新客户
- [ ] `GET /api/customers/:id/projects` - 客户项目列表
- [ ] `GET /api/customers/:id/orders` - 客户订单列表

**前端功能**:

- [ ] 客户详情页
  - [ ] 基础信息展示与编辑
  - [ ] 项目历史
  - [ ] 订单历史
  - [ ] 标签管理
  - [ ] 备注说明

#### 3.3 客户创建

**后端接口**:

- [ ] `POST /api/customers` - 创建客户

**前端功能**:

- [ ] 客户创建表单
  - [ ] 姓名、手机号必填
  - [ ] 微信 OpenID（可选）
  - [ ] 邮箱（可选）
  - [ ] 标签（可选）

**页面路径**: `/dashboard/crm/customers` - 页面存在，功能未实现

---

### 4. 系统设置完善 ⚙️

**状态**: 页面存在，功能未实现
**优先级**: 🟢 低

#### 4.1 角色管理

**后端接口**:

- [ ] `GET /api/roles` - 角色列表
- [ ] `POST /api/roles` - 创建角色
- [ ] `PATCH /api/roles/:id` - 更新角色
- [ ] `DELETE /api/roles/:id` - 删除角色

**前端功能**:

- [ ] 角色列表页
  - [ ] 角色表格
  - [ ] 创建角色按钮
- [ ] 角色编辑表单
  - [ ] 角色名称
  - [ ] 权限勾选（树形结构）
  - [ ] 数据范围设置

#### 4.2 账号管理

**后端接口**:

- [ ] `GET /api/users` - 用户列表
- [ ] `POST /api/users` - 创建用户
- [ ] `PATCH /api/users/:id` - 更新用户
- [ ] `POST /api/users/:id/reset-password` - 重置密码

**前端功能**:

- [ ] 用户列表页
  - [ ] 用户表格（姓名、角色、状态）
  - [ ] 创建用户按钮
- [ ] 用户创建表单
  - [ ] 姓名、账号、密码
  - [ ] 角色分配
  - [ ] 数据范围（门店/部门）
- [ ] 密码重置功能

**页面路径**: `/dashboard/settings/accounts` - 页面存在，功能未实现

#### 4.3 水印设置

**后端接口**:

- [ ] `GET /api/settings/watermark` - 获取水印配置
- [ ] `PATCH /api/settings/watermark` - 更新水印配置

**前端功能**:

- [ ] 水印设置页
  - [ ] Logo 上传
  - [ ] 透明度滑块（0-100%）
  - [ ] 位置选择（九宫格/全屏铺满）
  - [ ] 实时预览

#### 4.4 存储配置

**后端接口**:

- [ ] `GET /api/settings/storage` - 获取存储配置
- [ ] `PATCH /api/settings/storage` - 更新存储配置

**前端功能**:

- [ ] 存储配置页
  - [ ] S3/OSS 配置表单
  - [ ] 路径前缀配置
  - [ ] CDN 配置

**页面路径**: `/dashboard/settings/storage` - 页面存在，功能未实现

#### 4.5 小程序配置

**后端接口**:

- [ ] `GET /api/settings/miniprogram` - 获取小程序配置
- [ ] `PATCH /api/settings/miniprogram` - 更新小程序配置

**前端功能**:

- [ ] 小程序配置页
  - [ ] AppID / AppSecret 配置
  - [ ] 接口白名单
  - [ ] 订阅消息模板配置

**页面路径**: `/dashboard/settings/miniprogram` - 页面存在，功能未实现

---

## 🔧 技术债务与优化

### 1. 数据库迁移

- [ ] 创建完整的数据库迁移脚本
- [ ] 使用 TypeORM migrations 管理版本
- [ ] 编写回滚脚本
- [ ] 生产环境迁移方案

### 2. API 文档

- [ ] Swagger 文档完善
  - [ ] 所有业务 API 的请求/响应定义
  - [ ] 错误码文档
  - [ ] 示例代码
- [ ] Postman Collection 导出

### 3. 错误处理

- [ ] 统一错误码体系
- [ ] 前端错误提示优化
  - [ ] 表单验证提示
  - [ ] API 错误友好展示
  - [ ] 网络异常提示
- [ ] 后端日志完善
  - [ ] 结构化日志
  - [ ] 错误堆栈记录
  - [ ] 日志分级

### 4. 测试

- [ ] 单元测试
  - [ ] 后端 Service 层测试
  - [ ] 前端工具函数测试
- [ ] 集成测试
  - [ ] API 集成测试
  - [ ] 数据库集成测试
- [ ] E2E 测试
  - [ ] 关键流程 E2E（登录、创建项目、上传、选片）
  - [ ] Playwright/Cypress 配置

### 5. 性能优化

- [ ] 图片处理性能优化
  - [ ] 异步队列
  - [ ] Worker 并发控制
  - [ ] 处理超时策略
- [ ] 数据库查询优化
  - [ ] 索引优化
  - [ ] N+1 查询优化
  - [ ] 查询缓存
- [ ] 前端性能优化
  - [ ] 虚拟滚动（照片列表）
  - [ ] 图片懒加载
  - [ ] 路由懒加载

### 6. 安全加固

- [ ] XSS 防护
- [ ] CSRF 防护
- [ ] SQL 注入防护
- [ ] 文件上传安全（类型检查、大小限制、病毒扫描）
- [ ] 敏感数据加密存储
- [ ] API 访问频率限制

---

## 📅 开发里程碑

### Milestone 1: P0 核心闭环（2-3 周）

**目标**: 打通最小可行产品路径

**阶段 1.1: 数据模型（3-4 天）**

- [ ] 定义所有核心实体
- [ ] 创建数据库迁移
- [ ] 编写 Repository 层
- [ ] 编写单元测试

**阶段 1.2: 作品集管理 MVP（3-4 天）**

- [ ] Works CRUD（后端）
- [ ] 前端作品列表/编辑页
- [ ] 图片上传集成
- [ ] 基础分类功能

**阶段 1.3: 项目交付主流程（7-10 天）**

- [ ] 项目创建与列表（后端 + 前端）
- [ ] 照片上传与元数据入库（后端 + 前端）
- [ ] 异步处理服务（缩略图、水印）
- [ ] ViewerLink 生成（后端 + 前端）
- [ ] 客户选片端 MVP（浏览 + 选片 + 提交）

**阶段 1.4: 联调与测试（2-3 天）**

- [ ] 端到端流程测试
- [ ] Bug 修复
- [ ] 性能测试

---

### Milestone 2: P1 完整功能（2-3 周）

**目标**: 完善业务流程，支持实际运营

**阶段 2.1: 权限细化（2-3 天）**

- [ ] 数据隔离逻辑
- [ ] 细粒度权限点
- [ ] 前端按钮级权限控制

**阶段 2.2: 通知系统（3-4 天）**

- [ ] 通知服务模块
- [ ] 选择通知通道（小程序/短信/邮件）
- [ ] 前端通知中心
- [ ] 通知模板配置

**阶段 2.3: 精修交付（3-4 天）**

- [ ] 精修图上传
- [ ] 客户确认流程
- [ ] 交付状态流转

**阶段 2.4: 订单管理（3-4 天）**

- [ ] 订单列表与详情
- [ ] 线下录入
- [ ] 加片订单与支付
- [ ] 小程序订单同步

**阶段 2.5: ViewerLink 管理（2-3 天）**

- [ ] 链接管理功能
- [ ] 访问统计
- [ ] 过期/撤销策略

---

### Milestone 3: P2 增强功能（1-2 周）

**目标**: 提升运营效率和用户体验

**阶段 3.1: 数据看板（3-4 天）**

- [ ] Dashboard 概览
- [ ] 项目统计
- [ ] 收入统计
- [ ] 统计缓存

**阶段 3.2: 绩效统计（2-3 天）**

- [ ] 修图师绩效
- [ ] 绩效排行榜

**阶段 3.3: 系统设置完善（3-4 天）**

- [ ] 角色管理
- [ ] 账号管理
- [ ] 水印设置
- [ ] 存储配置
- [ ] 小程序配置

---

## 📝 使用说明

### 如何标记完成状态

1. 找到对应的功能项
2. 将 `- [ ]` 改为 `- [x]`
3. 可选：添加完成日期的注释，例如：
   ```markdown
   - [x] 功能名称 # 完成于 2026-01-10
   ```

### 如何标记部分完成

使用 🟨 标记，并添加说明：

```markdown
- [ ] 功能名称 🟨（前端已完成，后端接口开发中）
```

### 如何添加新发现的功能

在对应优先级章节下添加新的功能项，保持格式一致。

---

## 🔗 相关资源

- **PRD 文档**: [docs/admin/prd.md](./prd.md)
- **功能拆解**: [discuss/admin/prd-breakdown-and-todos.md](../../discuss/admin/prd-breakdown-and-todos.md)
- **Checklist**: [discuss/admin/prd-breakdown-and-todos.checklist.md](../../discuss/admin/prd-breakdown-and-todos.checklist.md)
- **上传方案**: [discuss/admin/upload-assets-signing-scheme.md](../../discuss/admin/upload-assets-signing-scheme.md)

---

**最后更新**: 2026-01-03
**维护者**: 开发团队
